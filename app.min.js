function getEl(e){return document.querySelector(e)}function init(e){generation=0,cellnum={},oranges=0,greens=0,dead=0,bothtribes=+form.bothtribes.value,maxGen=+form.gennum.value,S=Math.floor(windowW/colN),rowN=Math.floor(windowH/S),W=S*colN,H=S*rowN,dW=(windowW-W)/2,dH=(windowH-H)/2,colHN=(colN-1)/2,halfW=S*colHN,maxLС=getCellsNumber(P),informer=new Informer,game.width=W,game.height=H,grid.width=W,grid.height=H,game.style.left=dW+"px",game.style.top=dH+"px",grid.style.left=dW+"px",grid.style.top=dH+"px",pane.style.top=dH+"px",pane.style.right=dW+"px",pane.style.width=halfW+"px",pane.style.height=H+"px",form.live.value=maxLС,bothtribes?(orangeArr=getEmptyArray(colHN,rowN),greenArr=getEmptyArray(colHN,rowN),cellnum.greens=0,cellnum.oranges=0):(orangeArr=getEmptyArray(colHN,rowN),greenArr=getTribeArray(colHN,rowN,2),cellnum=checkCellNum(greenArr)),drawStage(orangeArr,"left"),gridOn&&drawGrid(S,colN,rowN,!0),e&&remClass(pane,"hidden")}function getCellsNumber(e){return Math.floor(colHN*rowN*e)}function Informer(){var e=this,r=W/2,n=H/8,a=n/1.2,t=(W-r)/2,o=(H-n)/2,i=t+r/2,l=i-n/4,g=i+n/4,s=o+n/2;e.msgOn=!1,e.drawScore=function(e){gс.save(),gс.font=a+"px fantasy",gс.textBaseline="middle",gс.fillStyle="#5A1F00",gс.lineWidth=5,gс.strokeStyle="#FDE792",gс.fillRect(t,o,r,n),gс.strokeRect(t,o,r,n),gс.fillStyle="#D1570D",gс.textAlign="end",gс.fillText(e.oranges,l,s),gс.textAlign="center",gс.fillStyle="#FDE792",gс.fillText(":",i,s),gс.textAlign="start",gс.fillStyle="#477725",gс.fillText(e.greens,g,s),gс.restore()},e.drawMessage=function(r){e.msgOn=!0,gс.save(),gс.font=a/2+"px fantasy";var t=gс.measureText(r).width,i=(W-t)/2;gс.textBaseline="middle",gс.fillStyle="#5A1F00",gс.lineWidth=5,gс.strokeStyle="#FDE792",gс.fillRect(i,o,t+n/2,n),gс.strokeRect(i,o,t+n/2,n),gс.fillStyle="#FDE792",gс.textAlign="start",gс.fillText(r,i+n/4,s),gс.restore()}}function getEmptyArray(e,r){for(var n,a=[],t=0;e>t;t++)for(a[t]=new Array(r),n=0;r>n;)a[t][n++]=0;return a}function getTribeArray(e,r,n){for(var a,t=getInitArray(e,r,n),o=[];t.length;)a=t.splice(0,r),o.push(a);return o}function getInitArray(e,r,n){var a,t,o=e*r-maxLС,i=new Array(maxLС),l=new Array(o);for(t=0;maxLС>t;)i[t++]=n;for(t=0;o>t;)l[t++]=0;return a=i.concat(l),shuffle(a)}function joinArrays(e,r){for(var n=e[0].length,a=new Array(n),t=0;n>t;)a[t++]=0;return e.concat([a],r)}function shuffle(e){for(var r,n=e.length;n;)r=Math.floor(Math.random()*n--),e[n]=[e[r],e[r]=e[n]][0];return e}function gameInit(){addClass(pane,"hidden"),bothtribes?(gridOn&&drawGrid(S,colN,rowN,"both"),drawStage(greenArr,"right"),drawStage(orangeArr,"left"),informer.drawMessage("Hit the spacebar when you're done."),mTimeout=setTimeout(function(){informer.msgOn=!1,gridOn?gridOn&&drawGrid(S,colN,rowN,"both"):gс.clearRect(0,0,W,H)},1e3)):startGame(2e3)}function startGame(e){bf1=getEmptyArray(colN,rowN),bf2=joinArrays(orangeArr,greenArr),gridOn&&drawGrid(S,colN,rowN),drawStage(bf2),mTimeout=setTimeout(function(){showMustGoOn()},e)}function drawStage(e,r){var n,a=e.length,t=0,o=0;for("right"===r&&(o=halfW+S);a>t;t++)for(n=0;rowN>n;n++)drawCell(o+t*S,n*S,e[t][n])}function drawGrid(e,r,n,a){var t,o,i=a?halfW:W,l=a?colHN+1:r+1,g=0;for(gс.strokeStyle=CLRS[3],gс.clearRect(0,0,W,H);l>g;g++)t=g*e,drawLine(t,0,t,H);for(g=0;n+1>g;g++)t=g*e,drawLine(0,t,i,t);if("both"===a){for(o=halfW+S,g=0;l>g;g++)t=o+g*e,drawLine(t,0,t,H);for(g=0;n+1>g;g++)t=g*e,drawLine(o,t,o+i,t)}}function drawLine(e,r,n,a){gс.beginPath(),gс.moveTo(e,r),gс.lineTo(n,a),gс.stroke()}function drawCell(e,r,n){c.fillStyle=CLRS[n],c.fillRect(e,r,S,S)}function showMustGoOn(){return informer.msgOn&&(clearTimeout(mTimeout),informer.msgOn=!1,gridOn?drawGrid(S,colN,rowN):gс.clearRect(0,0,W,H)),bothtribes?(bothtribes=!bothtribes,void startGame(500)):(animation=!animation,void(animation&&requestAnimationFrame(nextGen)))}function nextGen(){for(var e,r=0;colN>r;r++)for(e=0;rowN>e;e++)bf1[r][e]=calcState(r,e),drawCell(r*S,e*S,bf1[r][e]);bf1=[bf2,bf2=bf1][0],generation++,animation?generation>=maxGen?(animation=!animation,displayResults()):(generation%25===0&&(animation=checkCellNum(bf1,!0),animation||displayResults()),requestAnimationFrame(nextGen)):generation>=maxGen&&displayResults()}function checkState(){cellnum=checkCellNum(bf2),informer.drawScore(cellnum)}function displayResults(){cellnum=checkCellNum(bf2),informer.drawScore(cellnum)}function checkCellNum(e,r){for(var n,a=e.length,t=0,o={dead:0,oranges:0,greens:0};a>t;t++)for(n=0;rowN>n;n++)e[t][n]?1===e[t][n]?o.oranges++:o.greens++:o.dead++;return r?!!o.oranges&&!!o.greens:o}function calcState(e,r){for(var n,a=0>e-1?colN-1:e-1,t=e+1>colN-1?0:e+1,o=0>r-1?rowN-1:r-1,i=r+1>rowN-1?0:r+1,l=[bf2[a][o],bf2[a][r],bf2[a][i],bf2[e][o],bf2[e][i],bf2[t][o],bf2[t][r],bf2[t][i]],g=0,s=0,c=0,f=0;8>f;f++)l[f]?1===l[f]?s++:c++:g++;return n=s+c,bf2[e][r]?2>n||n>3?0:bf2[e][r]:3!==n?0:c>s?2:s>c?1:Math.floor(Math.random()+.5)}function generateArr(){bothtribes?(orangeArr=getTribeArray(colHN,rowN,1),greenArr=getTribeArray(colHN,rowN,2),cellnum=checkCellNum(greenArr),drawStage(greenArr,"right"),drawStage(orangeArr,"left"),gridOn&&drawGrid(S,colN,rowN,"both")):(orangeArr=getTribeArray(colHN,rowN,1),drawStage(orangeArr,"left"),cellnum.oranges=checkCellNum(orangeArr).oranges,gridOn&&drawGrid(S,colN,rowN,"left"))}function resetArr(){bothtribes?(orangeArr=getEmptyArray(colHN,rowN),greenArr=getEmptyArray(colHN,rowN),cellnum.greens=0,cellnum.oranges=0,drawStage(greenArr,"right"),drawStage(orangeArr,"left"),gridOn&&drawGrid(S,colN,rowN,"both")):(orangeArr=getEmptyArray(colHN,rowN),drawStage(orangeArr,!0),gridOn&&drawGrid(S,colN,rowN,"left"))}function applyConfig(){colN=+form.colnum.value,P=+form.popdens.value,maxGen=+form.gennum.value,gridOn=+form.showgrid.value,init()}function onSpanMouseUp(e){var r=document.getElementById(e.target.id.replace("nav","pane")),n=0;if(hasClass(e.target,"inactive-btn")){for(;n<navbtns.length;n++)addClass(navbtns[n],"inactive-btn");for(remClass(e.target,"inactive-btn"),n=0;n<panels.length;n++)addClass(panels[n],"hidden");remClass(r,"hidden")}}function onCanvasMouseUp(){dragging=!1}function onCanvasMouseDown(e){dragging=!0,onCanvasMouseMove(e)}function onCanvasMouseMove(e){if(dragging&&!animation){var r=getPointerPos(e.target,e),n=Math.floor(r.x/S),a=Math.floor(r.y/S);r.x<halfW?(cache.oranges.i!==n||cache.oranges.j!==a)&&(orangeArr[n][a]=orangeArr[n][a]?0:1,orangeArr[n][a]?(cellnum.oranges++,cellnum.oranges>maxLС&&(cellnum.oranges--,orangeArr[n][a]=0)):cellnum.oranges--,cache.oranges.i=n,cache.oranges.j=a,drawStage(orangeArr,"left")):bothtribes&&r.x>halfW+S&&(n-=colHN+1,(cache.greens.i!==n||cache.greens.j!==a)&&(greenArr[n][a]=greenArr[n][a]?0:2,greenArr[n][a]?(cellnum.greens++,cellnum.greens>maxLС&&(cellnum.greens--,greenArr[n][a]=0)):cellnum.greens--,cache.greens.i=n,cache.greens.j=a,drawStage(greenArr,"right")))}}function getCellCoord(e){Math.round(e.x/S),Math.round(e.y/S)}function hasClass(e,r){return(" "+e.className+" ").indexOf(" "+r+" ")>-1}function addClass(e,r){hasClass(e,r)||(e.className+=" "+r)}function remClass(e,r){e.className=e.className.replace(" "+r,"")}function getPointerPos(e,r){var n=e.getBoundingClientRect();return{x:r.pageX-n.left,y:r.pageY-n.top}}function pointInRect(e,r){return inRange(e.x,r.x,r.x+r.w)&&inRange(e.y,r.y,r.y+r.h)}function inRange(e,r,n){return e>=Math.min(r,n)&&e<=Math.max(r,n)}var colN=51,P=.5,S,rowN,orangeArr,playerLC,greenArr,enemyLC,battleArr1,battleArr2,maxLС,W,H,dW,dH,halfW,colHN,maxGen,CLRS=["#5A1F00","#D1570D","#477725","rgba(0,0,0,1)"],animation=!1,gridOn=!0,cache={greens:{i:1e3,j:1e3},oranges:{i:1e3,j:1e3}},mTimeout,bothtribes,dragging,cellnum,oranges,greens,dead,generation,game=getEl("#game"),grid=getEl("#grid"),pane=getEl("#pane"),apply=getEl("#apply"),rulesBtn=getEl("#nav-rules"),optionBtn=getEl("#nav-option"),navbtns=document.getElementsByClassName("btn"),panels=document.getElementsByClassName("panels"),form=document.forms[0],c=game.getContext("2d"),gс=grid.getContext("2d"),b=document.body,windowW=window.innerWidth,windowH=window.innerHeight,informer,battleArr1,battleArr2;b.onkeyup=function(e){switch(e.keyCode){case 32:showMustGoOn();break;case 27:animation||init(!0);break;case 39:animation||nextGen();break;case 37:animation||nextGen();break;case 38:animation||nextGen();break;case 40:animation||nextGen()}},b.onmouseup=function(e){if("SPAN"===e.target.nodeName)onSpanMouseUp(e);else if("CANVAS"===e.target.nodeName)onCanvasMouseUp(e);else if("DIV"===e.target.nodeName)switch(e.target.id){case"apply":applyConfig();break;case"start":gameInit();break;case"generate":generateArr();break;case"reset":resetArr();break;default:return!1}},grid.onmousedown=onCanvasMouseDown,grid.onmousemove=onCanvasMouseMove,init();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBwLm1pbi5qcyIsInNvdXJjZXMiOlsiYS5qcyIsImIuanMiLCJjLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQXVDQSxRQUFBLE9BQUEsR0FDQSxNQUFBLFVBQUEsY0FBQSxHQXFCQSxRQUFBLE1BQUEsR0FDQSxXQUFBLEVBQ0EsV0FDQSxRQUFBLEVBQ0EsT0FBQSxFQUNBLEtBQUEsRUFDQSxZQUFBLEtBQUEsV0FBQSxNQUNBLFFBQUEsS0FBQSxPQUFBLE1BQ0EsRUFBQSxLQUFBLE1BQUEsUUFBQSxNQUNBLEtBQUEsS0FBQSxNQUFBLFFBQUEsR0FDQSxFQUFBLEVBQUEsS0FDQSxFQUFBLEVBQUEsS0FDQSxJQUFBLFFBQUEsR0FBQSxFQUNBLElBQUEsUUFBQSxHQUFBLEVBQ0EsT0FBQSxLQUFBLEdBQUEsRUFDQSxNQUFBLEVBQUEsTUFDQSxNQUFBLGVBQUEsR0FDQSxTQUFBLEdBQUEsVUFFQSxLQUFBLE1BQUEsRUFDQSxLQUFBLE9BQUEsRUFDQSxLQUFBLE1BQUEsRUFDQSxLQUFBLE9BQUEsRUFDQSxLQUFBLE1BQUEsS0FBQSxHQUFBLEtBQ0EsS0FBQSxNQUFBLElBQUEsR0FBQSxLQUNBLEtBQUEsTUFBQSxLQUFBLEdBQUEsS0FDQSxLQUFBLE1BQUEsSUFBQSxHQUFBLEtBRUEsS0FBQSxNQUFBLElBQUEsR0FBQSxLQUNBLEtBQUEsTUFBQSxNQUFBLEdBQUEsS0FDQSxLQUFBLE1BQUEsTUFBQSxNQUFBLEtBQ0EsS0FBQSxNQUFBLE9BQUEsRUFBQSxLQUNBLEtBQUEsS0FBQSxNQUFBLE1BRUEsWUFDQSxVQUFBLGNBQUEsTUFBQSxNQUNBLFNBQUEsY0FBQSxNQUFBLE1BQ0EsUUFBQSxPQUFBLEVBQ0EsUUFBQSxRQUFBLElBRUEsVUFBQSxjQUFBLE1BQUEsTUFDQSxTQUFBLGNBQUEsTUFBQSxLQUFBLEdBQ0EsUUFBQSxhQUFBLFdBR0EsVUFBQSxVQUFBLFFBRUEsUUFBQSxTQUFBLEVBQUEsS0FBQSxNQUFBLEdBQ0EsR0FBQSxTQUFBLEtBQUEsVUFHQSxRQUFBLGdCQUFBLEdBQ0EsTUFBQSxNQUFBLE1BQUEsTUFBQSxLQUFBLEdBR0EsUUFBQSxZQUNBLEdBQUEsR0FBQSxLQUNBLEVBQUEsRUFBQSxFQUNBLEVBQUEsRUFBQSxFQUNBLEVBQUEsRUFBQSxJQUNBLEdBQUEsRUFBQSxHQUFBLEVBQ0EsR0FBQSxFQUFBLEdBQUEsRUFDQSxFQUFBLEVBQUEsRUFBQSxFQUNBLEVBQUEsRUFBQSxFQUFBLEVBQ0EsRUFBQSxFQUFBLEVBQUEsRUFDQSxFQUFBLEVBQUEsRUFBQSxDQUVBLEdBQUEsT0FBQSxFQUVBLEVBQUEsVUFBQSxTQUFBLEdBQ0EsR0FBQSxPQUNBLEdBQUEsS0FBQSxFQUFBLGFBQ0EsR0FBQSxhQUFBLFNBQ0EsR0FBQSxVQUFBLFVBQ0EsR0FBQSxVQUFBLEVBQ0EsR0FBQSxZQUFBLFVBQ0EsR0FBQSxTQUFBLEVBQUEsRUFBQSxFQUFBLEdBQ0EsR0FBQSxXQUFBLEVBQUEsRUFBQSxFQUFBLEdBQ0EsR0FBQSxVQUFBLFVBQ0EsR0FBQSxVQUFBLE1BQ0EsR0FBQSxTQUFBLEVBQUEsUUFBQSxFQUFBLEdBQ0EsR0FBQSxVQUFBLFNBQ0EsR0FBQSxVQUFBLFVBQ0EsR0FBQSxTQUFBLElBQUEsRUFBQSxHQUNBLEdBQUEsVUFBQSxRQUNBLEdBQUEsVUFBQSxVQUNBLEdBQUEsU0FBQSxFQUFBLE9BQUEsRUFBQSxHQUNBLEdBQUEsV0FFQSxFQUFBLFlBQUEsU0FBQSxHQUNBLEVBQUEsT0FBQSxFQUNBLEdBQUEsT0FDQSxHQUFBLEtBQUEsRUFBQSxFQUFBLFlBQ0EsSUFBQSxHQUFBLEdBQUEsWUFBQSxHQUFBLE1BQ0EsR0FBQSxFQUFBLEdBQUEsQ0FDQSxJQUFBLGFBQUEsU0FDQSxHQUFBLFVBQUEsVUFDQSxHQUFBLFVBQUEsRUFDQSxHQUFBLFlBQUEsVUFDQSxHQUFBLFNBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEdBQ0EsR0FBQSxXQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxHQUNBLEdBQUEsVUFBQSxVQUNBLEdBQUEsVUFBQSxRQUNBLEdBQUEsU0FBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEdBQ0EsR0FBQSxXQUlBLFFBQUEsZUFBQSxFQUFBLEdBRUEsSUFEQSxHQUFBLEdBQUEsS0FBQSxFQUFBLEVBQ0EsRUFBQSxFQUFBLElBRUEsSUFEQSxFQUFBLEdBQUEsR0FBQSxPQUFBLEdBQ0EsRUFBQSxFQUFBLEVBQUEsR0FBQSxFQUFBLEdBQUEsS0FBQSxDQUVBLE9BQUEsR0FHQSxRQUFBLGVBQUEsRUFBQSxFQUFBLEdBSUEsSUFIQSxHQUVBLEdBRkEsRUFBQSxhQUFBLEVBQUEsRUFBQSxHQUNBLEtBRUEsRUFBQSxRQUNBLEVBQUEsRUFBQSxPQUFBLEVBQUEsR0FDQSxFQUFBLEtBQUEsRUFFQSxPQUFBLEdBR0EsUUFBQSxjQUFBLEVBQUEsRUFBQSxHQUNBLEdBR0EsR0FBQSxFQUhBLEVBQUEsRUFBQSxFQUFBLE1BQ0EsRUFBQSxHQUFBLE9BQUEsT0FDQSxFQUFBLEdBQUEsT0FBQSxFQUVBLEtBQUEsRUFBQSxFQUFBLE1BQUEsR0FBQSxFQUFBLEtBQUEsQ0FDQSxLQUFBLEVBQUEsRUFBQSxFQUFBLEdBQUEsRUFBQSxLQUFBLENBRUEsT0FEQSxHQUFBLEVBQUEsT0FBQSxHQUNBLFFBQUEsR0FHQSxRQUFBLFlBQUEsRUFBQSxHQUlBLElBSEEsR0FBQSxHQUFBLEVBQUEsR0FBQSxPQUNBLEVBQUEsR0FBQSxPQUFBLEdBQ0EsRUFBQSxFQUNBLEVBQUEsR0FBQSxFQUFBLEtBQUEsQ0FDQSxPQUFBLEdBQUEsUUFBQSxHQUFBLEdBSUEsUUFBQSxTQUFBLEdBRUEsSUFEQSxHQUFBLEdBQUEsRUFBQSxFQUFBLE9BQ0EsR0FDQSxFQUFBLEtBQUEsTUFBQSxLQUFBLFNBQUEsS0FDQSxFQUFBLElBQUEsRUFBQSxHQUFBLEVBQUEsR0FBQSxFQUFBLElBQUEsRUFFQSxPQUFBLEdDck5BLFFBQUEsWUFDQSxTQUFBLEtBQUEsVUFDQSxZQUNBLFFBQUEsU0FBQSxFQUFBLEtBQUEsS0FBQSxRQUNBLFVBQUEsU0FBQSxTQUNBLFVBQUEsVUFBQSxRQUNBLFNBQUEsWUFBQSxzQ0FDQSxTQUFBLFdBQUEsV0FDQSxTQUFBLE9BQUEsRUFDQSxPQUNBLFFBQUEsU0FBQSxFQUFBLEtBQUEsS0FBQSxRQUVBLEdBQUEsVUFBQSxFQUFBLEVBQUEsRUFBQSxJQUVBLE1BRUEsVUFBQSxLQUlBLFFBQUEsV0FBQSxHQUNBLElBQUEsY0FBQSxLQUFBLE1BQ0EsSUFBQSxXQUFBLFVBQUEsVUFDQSxRQUFBLFNBQUEsRUFBQSxLQUFBLE1BQ0EsVUFBQSxLQUNBLFNBQUEsV0FBQSxXQUNBLGdCQUNBLEdBR0EsUUFBQSxXQUFBLEVBQUEsR0FDQSxHQUNBLEdBREEsRUFBQSxFQUFBLE9BQ0EsRUFBQSxFQUFBLEVBQUEsQ0FJQSxLQUhBLFVBQUEsSUFDQSxFQUFBLE1BQUEsR0FFQSxFQUFBLEVBQUEsSUFDQSxJQUFBLEVBQUEsRUFBQSxLQUFBLEVBQUEsSUFDQSxTQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEdBQUEsSUFLQSxRQUFBLFVBQUEsRUFBQSxFQUFBLEVBQUEsR0FDQSxHQUVBLEdBQUEsRUFGQSxFQUFBLEVBQUEsTUFBQSxFQUNBLEVBQUEsRUFBQSxNQUFBLEVBQUEsRUFBQSxFQUNBLEVBQUEsQ0FHQSxLQUZBLEdBQUEsWUFBQSxLQUFBLEdBQ0EsR0FBQSxVQUFBLEVBQUEsRUFBQSxFQUFBLEdBQ0EsRUFBQSxFQUFBLElBQ0EsRUFBQSxFQUFBLEVBQ0EsU0FBQSxFQUFBLEVBQUEsRUFBQSxFQUVBLEtBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLElBQ0EsRUFBQSxFQUFBLEVBQ0EsU0FBQSxFQUFBLEVBQUEsRUFBQSxFQUVBLElBQUEsU0FBQSxFQUFBLENBRUEsSUFEQSxFQUFBLE1BQUEsRUFDQSxFQUFBLEVBQUEsRUFBQSxFQUFBLElBQ0EsRUFBQSxFQUFBLEVBQUEsRUFDQSxTQUFBLEVBQUEsRUFBQSxFQUFBLEVBRUEsS0FBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsSUFDQSxFQUFBLEVBQUEsRUFDQSxTQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsSUFLQSxRQUFBLFVBQUEsRUFBQSxFQUFBLEVBQUEsR0FDQSxHQUFBLFlBQ0EsR0FBQSxPQUFBLEVBQUEsR0FDQSxHQUFBLE9BQUEsRUFBQSxHQUNBLEdBQUEsU0FHQSxRQUFBLFVBQUEsRUFBQSxFQUFBLEdBQ0EsRUFBQSxVQUFBLEtBQUEsR0FDQSxFQUFBLFNBQUEsRUFBQSxFQUFBLEVBQUEsR0FHQSxRQUFBLGdCQVVBLE1BVEEsVUFBQSxRQUNBLGFBQUEsVUFDQSxTQUFBLE9BQUEsRUFDQSxPQUNBLFNBQUEsRUFBQSxLQUFBLE1BRUEsR0FBQSxVQUFBLEVBQUEsRUFBQSxFQUFBLElBR0EsWUFDQSxZQUFBLGVBQ0EsV0FBQSxPQUdBLFdBQUEsZUFDQSxXQUFBLHNCQUFBLFdBR0EsUUFBQSxXQUVBLElBREEsR0FBQSxHQUFBLEVBQUEsRUFDQSxLQUFBLEVBQUEsSUFDQSxJQUFBLEVBQUEsRUFBQSxLQUFBLEVBQUEsSUFDQSxJQUFBLEdBQUEsR0FBQSxVQUFBLEVBQUEsR0FDQSxTQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsSUFBQSxHQUFBLEdBR0EsTUFBQSxJQUFBLElBQUEsS0FBQSxHQUNBLGFBQ0EsVUFDQSxZQUFBLFFBQ0EsV0FBQSxVQUNBLG1CQUVBLFdBQUEsS0FBQSxJQUNBLFVBQUEsYUFBQSxLQUFBLEdBQ0EsV0FBQSxrQkFFQSxzQkFBQSxVQUdBLFlBQUEsUUFDQSxpQkFLQSxRQUFBLGNBQ0EsUUFBQSxhQUFBLEtBQ0EsU0FBQSxVQUFBLFNBR0EsUUFBQSxrQkFDQSxRQUFBLGFBQUEsS0FDQSxTQUFBLFVBQUEsU0FHQSxRQUFBLGNBQUEsRUFBQSxHQVFBLElBUEEsR0FDQSxHQURBLEVBQUEsRUFBQSxPQUNBLEVBQUEsRUFDQSxHQUNBLEtBQUEsRUFDQSxRQUFBLEVBQ0EsT0FBQSxHQUVBLEVBQUEsRUFBQSxJQUNBLElBQUEsRUFBQSxFQUFBLEtBQUEsRUFBQSxJQUNBLEVBQUEsR0FBQSxHQUNBLElBQUEsRUFBQSxHQUFBLEdBQ0EsRUFBQSxVQUVBLEVBQUEsU0FHQSxFQUFBLE1BS0EsT0FBQSxLQUNBLEVBQUEsV0FBQSxFQUFBLE9BRUEsRUFHQSxRQUFBLFdBQUEsRUFBQSxHQW1CQSxJQWhCQSxHQWVBLEdBZkEsRUFBQSxFQUFBLEVBQUEsRUFBQSxLQUFBLEVBQUEsRUFBQSxFQUNBLEVBQUEsRUFBQSxFQUFBLEtBQUEsRUFBQSxFQUFBLEVBQUEsRUFDQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEtBQUEsRUFBQSxFQUFBLEVBQ0EsRUFBQSxFQUFBLEVBQUEsS0FBQSxFQUFBLEVBQUEsRUFBQSxFQUVBLEdBQ0EsSUFBQSxHQUFBLEdBQ0EsSUFBQSxHQUFBLEdBQ0EsSUFBQSxHQUFBLEdBQ0EsSUFBQSxHQUFBLEdBQ0EsSUFBQSxHQUFBLEdBQ0EsSUFBQSxHQUFBLEdBQ0EsSUFBQSxHQUFBLEdBQ0EsSUFBQSxHQUFBLElBRUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxFQUNBLEVBQUEsRUFBQSxJQUNBLEVBQUEsR0FDQSxJQUFBLEVBQUEsR0FDQSxJQUVBLElBR0EsR0FNQSxPQUhBLEdBQUEsRUFBQSxFQUdBLElBQUEsR0FBQSxHQUNBLEVBQUEsR0FBQSxFQUFBLEVBQUEsRUFBQSxJQUFBLEdBQUEsR0FHQSxJQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxLQUFBLE1BQUEsS0FBQSxTQUFBLElDL0tBLFFBQUEsZUFDQSxZQUNBLFVBQUEsY0FBQSxNQUFBLEtBQUEsR0FDQSxTQUFBLGNBQUEsTUFBQSxLQUFBLEdBQ0EsUUFBQSxhQUFBLFVBQ0EsVUFBQSxTQUFBLFNBQ0EsVUFBQSxVQUFBLFFBQ0EsUUFBQSxTQUFBLEVBQUEsS0FBQSxLQUFBLFVBRUEsVUFBQSxjQUFBLE1BQUEsS0FBQSxHQUNBLFVBQUEsVUFBQSxRQUNBLFFBQUEsUUFBQSxhQUFBLFdBQUEsUUFDQSxRQUFBLFNBQUEsRUFBQSxLQUFBLEtBQUEsU0FJQSxRQUFBLFlBQ0EsWUFDQSxVQUFBLGNBQUEsTUFBQSxNQUNBLFNBQUEsY0FBQSxNQUFBLE1BQ0EsUUFBQSxPQUFBLEVBQ0EsUUFBQSxRQUFBLEVBQ0EsVUFBQSxTQUFBLFNBQ0EsVUFBQSxVQUFBLFFBQ0EsUUFBQSxTQUFBLEVBQUEsS0FBQSxLQUFBLFVBRUEsVUFBQSxjQUFBLE1BQUEsTUFDQSxVQUFBLFdBQUEsR0FDQSxRQUFBLFNBQUEsRUFBQSxLQUFBLEtBQUEsU0FJQSxRQUFBLGVBQ0EsTUFBQSxLQUFBLE9BQUEsTUFDQSxHQUFBLEtBQUEsUUFBQSxNQUNBLFFBQUEsS0FBQSxPQUFBLE1BQ0EsUUFBQSxLQUFBLFNBQUEsTUFDQSxPQUlBLFFBQUEsZUFBQSxHQUNBLEdBQUEsR0FBQSxTQUFBLGVBQUEsRUFBQSxPQUFBLEdBQUEsUUFBQSxNQUFBLFNBQ0EsRUFBQSxDQUNBLElBQUEsU0FBQSxFQUFBLE9BQUEsZ0JBQUEsQ0FDQSxLQUFBLEVBQUEsUUFBQSxPQUFBLElBQ0EsU0FBQSxRQUFBLEdBQUEsZUFHQSxLQURBLFNBQUEsRUFBQSxPQUFBLGdCQUNBLEVBQUEsRUFBQSxFQUFBLE9BQUEsT0FBQSxJQUNBLFNBQUEsT0FBQSxHQUFBLFNBRUEsVUFBQSxFQUFBLFdBSUEsUUFBQSxtQkFDQSxVQUFBLEVBR0EsUUFBQSxtQkFBQSxHQUNBLFVBQUEsRUFDQSxrQkFBQSxHQUdBLFFBQUEsbUJBQUEsR0FDQSxHQUFBLFdBQUEsVUFBQSxDQUNBLEdBQUEsR0FBQSxjQUFBLEVBQUEsT0FBQSxHQUNBLEVBQUEsS0FBQSxNQUFBLEVBQUEsRUFBQSxHQUNBLEVBQUEsS0FBQSxNQUFBLEVBQUEsRUFBQSxFQUNBLEdBQUEsRUFBQSxPQUNBLE1BQUEsUUFBQSxJQUFBLEdBQUEsTUFBQSxRQUFBLElBQUEsS0FDQSxVQUFBLEdBQUEsR0FBQSxVQUFBLEdBQUEsR0FBQSxFQUFBLEVBQ0EsVUFBQSxHQUFBLElBQ0EsUUFBQSxVQUNBLFFBQUEsUUFBQSxRQUNBLFFBQUEsVUFDQSxVQUFBLEdBQUEsR0FBQSxJQUdBLFFBQUEsVUFFQSxNQUFBLFFBQUEsRUFBQSxFQUNBLE1BQUEsUUFBQSxFQUFBLEVBQ0EsVUFBQSxVQUFBLFNBRUEsWUFBQSxFQUFBLEVBQUEsTUFBQSxJQUNBLEdBQUEsTUFBQSxHQUNBLE1BQUEsT0FBQSxJQUFBLEdBQUEsTUFBQSxPQUFBLElBQUEsS0FDQSxTQUFBLEdBQUEsR0FBQSxTQUFBLEdBQUEsR0FBQSxFQUFBLEVBQ0EsU0FBQSxHQUFBLElBQ0EsUUFBQSxTQUNBLFFBQUEsT0FBQSxRQUNBLFFBQUEsU0FDQSxTQUFBLEdBQUEsR0FBQSxJQUdBLFFBQUEsU0FFQSxNQUFBLE9BQUEsRUFBQSxFQUNBLE1BQUEsT0FBQSxFQUFBLEVBQ0EsVUFBQSxTQUFBLFlBTUEsUUFBQSxjQUFBLEdBQ0EsS0FBQSxNQUFBLEVBQUEsRUFBQSxHQUNBLEtBQUEsTUFBQSxFQUFBLEVBQUEsR0FHQSxRQUFBLFVBQUEsRUFBQSxHQUNBLE9BQUEsSUFBQSxFQUFBLFVBQUEsS0FBQSxRQUFBLElBQUEsRUFBQSxLQUFBLEdBR0EsUUFBQSxVQUFBLEVBQUEsR0FDQSxTQUFBLEVBQUEsS0FDQSxFQUFBLFdBQUEsSUFBQSxHQUdBLFFBQUEsVUFBQSxFQUFBLEdBQ0EsRUFBQSxVQUFBLEVBQUEsVUFBQSxRQUFBLElBQUEsRUFBQSxJQUdBLFFBQUEsZUFBQSxFQUFBLEdBQ0EsR0FBQSxHQUFBLEVBQUEsdUJBQ0EsUUFDQSxFQUFBLEVBQUEsTUFBQSxFQUFBLEtBQ0EsRUFBQSxFQUFBLE1BQUEsRUFBQSxLQUlBLFFBQUEsYUFBQSxFQUFBLEdBQ0EsTUFBQSxTQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsSUFBQSxRQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsR0FHQSxRQUFBLFNBQUEsRUFBQSxFQUFBLEdBQ0EsTUFBQSxJQUFBLEtBQUEsSUFBQSxFQUFBLElBQUEsR0FBQSxLQUFBLElBQUEsRUFBQSxHRnhLQSxHQUFBLE1BQUEsR0FDQSxFQUFBLEdBQ0EsRUFDQSxLQUNBLFVBQ0EsU0FDQSxTQUNBLFFBQ0EsV0FDQSxXQUNBLE1BQ0EsRUFBQSxFQUFBLEdBQUEsR0FBQSxNQUFBLE1BQUEsT0FDQSxNQUFBLFVBQUEsVUFBQSxVQUFBLGlCQUNBLFdBQUEsRUFDQSxRQUFBLEVBQ0EsT0FDQSxRQUNBLEVBQUEsSUFDQSxFQUFBLEtBRUEsU0FDQSxFQUFBLElBQ0EsRUFBQSxNQUdBLFNBQ0EsV0FDQSxTQUNBLFFBQ0EsUUFDQSxPQUNBLEtBQ0EsV0FXQSxLQUFBLE1BQUEsU0FDQSxLQUFBLE1BQUEsU0FDQSxLQUFBLE1BQUEsU0FDQSxNQUFBLE1BQUEsVUFDQSxTQUFBLE1BQUEsY0FDQSxVQUFBLE1BQUEsZUFDQSxRQUFBLFNBQUEsdUJBQUEsT0FDQSxPQUFBLFNBQUEsdUJBQUEsVUFDQSxLQUFBLFNBQUEsTUFBQSxHQUNBLEVBQUEsS0FBQSxXQUFBLE1BQ0EsR0FBQSxLQUFBLFdBQUEsTUFDQSxFQUFBLFNBQUEsS0FDQSxRQUFBLE9BQUEsV0FDQSxRQUFBLE9BQUEsWUFDQSxTQUNBLFdBQUEsVUV6REEsR0FBQSxRQUFBLFNBQUEsR0FDQSxPQUFBLEVBQUEsU0FDQSxJQUFBLElBQUEsY0FBQSxNQUNBLEtBQUEsSUFBQSxXQUFBLE1BQUEsRUFBQSxNQUNBLEtBQUEsSUFBQSxXQUFBLFNBQUEsTUFDQSxLQUFBLElBQUEsV0FBQSxTQUFBLE1BQ0EsS0FBQSxJQUFBLFdBQUEsU0FBQSxNQUNBLEtBQUEsSUFBQSxXQUFBLFlBSUEsRUFBQSxVQUFBLFNBQUEsR0FDQSxHQUFBLFNBQUEsRUFBQSxPQUFBLFNBQ0EsY0FBQSxPQUNBLElBQUEsV0FBQSxFQUFBLE9BQUEsU0FDQSxnQkFBQSxPQUNBLElBQUEsUUFBQSxFQUFBLE9BQUEsU0FDQSxPQUFBLEVBQUEsT0FBQSxJQUNBLElBQUEsUUFBQSxhQUFBLE1BQ0EsS0FBQSxRQUFBLFVBQUEsTUFDQSxLQUFBLFdBQUEsYUFBQSxNQUNBLEtBQUEsUUFBQSxVQUFBLE1BQ0EsU0FBQSxPQUFBLElBSUEsS0FBQSxZQUFBLGtCQUNBLEtBQUEsWUFBQSxrQkErSUEiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBqc2hpbnQgc3RyaWN0OiBmYWxzZSAqL1xyXG52YXIgY29sTiA9IDUxLCAgIC8vIGluaXRpYWwgbnVtYmVyIG9mIGNvbHVtbnNcclxuICAgIFAgPSAwLjUsICAgIC8vIGRlbnNpdHkgb2YgdGhlIHBvcHVsYXRpb25cclxuICAgIFMsICAgICAgICAgIC8vIGNlbGwncyBzaXplXHJcbiAgICByb3dOLFxyXG4gICAgb3JhbmdlQXJyLFxyXG4gICAgcGxheWVyTEMsXHJcbiAgICBncmVlbkFycixcclxuICAgIGVuZW15TEMsICAgICAgICAgLy8gbnVtYmVyIG9mIHJvd3NcclxuICAgIGJhdHRsZUFycjEsICAgICAgICAgIC8vIGFycmF5IHRvIGtlZXAgc3RhdGUgb2YgZWFjaCBjZWxsXHJcbiAgICBiYXR0bGVBcnIyLFxyXG4gICAgbWF4TNChLFxyXG4gICAgVywgSCwgZFcsIGRILCBoYWxmVywgY29sSE4sIG1heEdlbixcclxuICAgIENMUlMgPSBbXCIjNUExRjAwXCIsIFwiI0QxNTcwRFwiLFwiIzQ3NzcyNVwiLCBcInJnYmEoMCwwLDAsMSlcIl0sXHJcbiAgICBhbmltYXRpb24gPSBmYWxzZSwgLy8gbWFyayB0aGF0IGFuaW1hdGlvbidzIG9uXHJcbiAgICBncmlkT24gPSB0cnVlLFxyXG4gICAgY2FjaGUgPSB7XHJcbiAgICAgICAgZ3JlZW5zOiB7XHJcbiAgICAgICAgICAgIGk6IDEwMDAsXHJcbiAgICAgICAgICAgIGo6IDEwMDBcclxuICAgICAgICB9LFxyXG4gICAgICAgIG9yYW5nZXM6IHtcclxuICAgICAgICAgICAgaTogMTAwMCxcclxuICAgICAgICAgICAgajogMTAwMFxyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbiAgICBtVGltZW91dCxcclxuICAgIGJvdGh0cmliZXMsXHJcbiAgICBkcmFnZ2luZyxcclxuICAgIGNlbGxudW0sXHJcbiAgICBvcmFuZ2VzLFxyXG4gICAgZ3JlZW5zLFxyXG4gICAgZGVhZCxcclxuICAgIGdlbmVyYXRpb247XHJcbi8vIEE5Q0M2NlxyXG4vLyA0Nzc3MjUrXHJcbi8vIEZERTc5MlxyXG4vLyBEMTU3MEQrXHJcbi8vIDVBMUYwMCtcclxuZnVuY3Rpb24gZ2V0RWwocykge1xyXG4gICAgcmV0dXJuIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Iocyk7XHJcblxyXG59XHJcblxyXG52YXIgZ2FtZSA9IGdldEVsKFwiI2dhbWVcIiksXHJcbiAgICBncmlkID0gZ2V0RWwoXCIjZ3JpZFwiKSxcclxuICAgIHBhbmUgPSBnZXRFbChcIiNwYW5lXCIpLFxyXG4gICAgYXBwbHkgPSBnZXRFbChcIiNhcHBseVwiKSxcclxuICAgIHJ1bGVzQnRuID0gZ2V0RWwoXCIjbmF2LXJ1bGVzXCIpLFxyXG4gICAgb3B0aW9uQnRuID0gZ2V0RWwoXCIjbmF2LW9wdGlvblwiKSxcclxuICAgIG5hdmJ0bnMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFwiYnRuXCIpLFxyXG4gICAgcGFuZWxzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShcInBhbmVsc1wiKSxcclxuICAgIGZvcm0gPSBkb2N1bWVudC5mb3Jtc1swXSxcclxuICAgIGMgPSBnYW1lLmdldENvbnRleHQoXCIyZFwiKSxcclxuICAgIGfRgSA9IGdyaWQuZ2V0Q29udGV4dChcIjJkXCIpLFxyXG4gICAgYiA9IGRvY3VtZW50LmJvZHksXHJcbiAgICB3aW5kb3dXID0gd2luZG93LmlubmVyV2lkdGgsXHJcbiAgICB3aW5kb3dIID0gd2luZG93LmlubmVySGVpZ2h0LFxyXG4gICAgaW5mb3JtZXIsXHJcbiAgICBiYXR0bGVBcnIxLCBiYXR0bGVBcnIyO1xyXG5cclxuZnVuY3Rpb24gaW5pdChzaG93cGFuZWwpIHtcclxuICAgIGdlbmVyYXRpb24gPSAwO1xyXG4gICAgY2VsbG51bSA9IHt9O1xyXG4gICAgb3JhbmdlcyA9IDA7XHJcbiAgICBncmVlbnMgPSAwO1xyXG4gICAgZGVhZCA9IDA7XHJcbiAgICBib3RodHJpYmVzID0gK2Zvcm0uYm90aHRyaWJlcy52YWx1ZTtcclxuICAgIG1heEdlbiA9ICtmb3JtLmdlbm51bS52YWx1ZTtcclxuICAgIFMgPSBNYXRoLmZsb29yKHdpbmRvd1cvY29sTik7XHJcbiAgICByb3dOID0gTWF0aC5mbG9vcih3aW5kb3dIL1MpO1xyXG4gICAgVyA9IFMgKiBjb2xOO1xyXG4gICAgSCA9IFMgKiByb3dOO1xyXG4gICAgZFcgPSAod2luZG93VyAtIFcpLzI7XHJcbiAgICBkSCA9ICh3aW5kb3dIIC0gSCkvMjtcclxuICAgIGNvbEhOID0oY29sTiAtIDEpLzI7XHJcbiAgICBoYWxmVyA9IFMgKiBjb2xITjtcclxuICAgIG1heEzQoSA9IGdldENlbGxzTnVtYmVyKFApO1xyXG4gICAgaW5mb3JtZXIgPSBuZXcgSW5mb3JtZXIoKTtcclxuXHJcbiAgICBnYW1lLndpZHRoID0gVztcclxuICAgIGdhbWUuaGVpZ2h0ID0gSDtcclxuICAgIGdyaWQud2lkdGggPSBXO1xyXG4gICAgZ3JpZC5oZWlnaHQgPSBIO1xyXG4gICAgZ2FtZS5zdHlsZS5sZWZ0ID0gZFcgKyBcInB4XCI7XHJcbiAgICBnYW1lLnN0eWxlLnRvcCA9IGRIICsgXCJweFwiO1xyXG4gICAgZ3JpZC5zdHlsZS5sZWZ0ID0gZFcgKyBcInB4XCI7XHJcbiAgICBncmlkLnN0eWxlLnRvcCA9IGRIICsgXCJweFwiO1xyXG5cclxuICAgIHBhbmUuc3R5bGUudG9wID0gZEggKyBcInB4XCI7XHJcbiAgICBwYW5lLnN0eWxlLnJpZ2h0ID0gZFcgKyBcInB4XCI7XHJcbiAgICBwYW5lLnN0eWxlLndpZHRoID0gaGFsZlcgKyBcInB4XCI7XHJcbiAgICBwYW5lLnN0eWxlLmhlaWdodCA9IEggKyBcInB4XCI7XHJcbiAgICBmb3JtLmxpdmUudmFsdWUgPSBtYXhM0KE7XHJcblxyXG4gICAgaWYgKCBib3RodHJpYmVzICkge1xyXG4gICAgICAgIG9yYW5nZUFyciA9IGdldEVtcHR5QXJyYXkoY29sSE4sIHJvd04pO1xyXG4gICAgICAgIGdyZWVuQXJyID0gZ2V0RW1wdHlBcnJheShjb2xITiwgcm93Tik7XHJcbiAgICAgICAgY2VsbG51bS5ncmVlbnMgPSAwO1xyXG4gICAgICAgIGNlbGxudW0ub3JhbmdlcyA9IDA7XHJcbiAgICB9ZWxzZSB7XHJcbiAgICAgICAgb3JhbmdlQXJyID0gZ2V0RW1wdHlBcnJheShjb2xITiwgcm93Tik7XHJcbiAgICAgICAgZ3JlZW5BcnIgPSBnZXRUcmliZUFycmF5KGNvbEhOLCByb3dOLCAyKTtcclxuICAgICAgICBjZWxsbnVtID0gY2hlY2tDZWxsTnVtKGdyZWVuQXJyKTtcclxuICAgIH1cclxuXHJcbiAgICBkcmF3U3RhZ2Uob3JhbmdlQXJyLCBcImxlZnRcIik7XHJcblxyXG4gICAgaWYgKCBncmlkT24gKSB7IGRyYXdHcmlkKFMsIGNvbE4sIHJvd04sIHRydWUpOyB9XHJcbiAgICBpZiAoIHNob3dwYW5lbCApIHsgcmVtQ2xhc3MocGFuZSwgXCJoaWRkZW5cIik7IH1cclxufVxyXG5cclxuZnVuY3Rpb24gZ2V0Q2VsbHNOdW1iZXIocCkge1xyXG4gICAgcmV0dXJuIE1hdGguZmxvb3IoY29sSE4gKiByb3dOICogcCk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIEluZm9ybWVyKCkge1xyXG4gICAgdmFyIHNlbGYgPSB0aGlzLFxyXG4gICAgICAgIHcgPSBXLzIsXHJcbiAgICAgICAgaCA9IEgvOCxcclxuICAgICAgICBmcyA9IGgvMS4yLFxyXG4gICAgICAgIHJlY3RYID0gKFcgLSB3KS8yLFxyXG4gICAgICAgIHJlY3RZID0gKEggLSBoKS8yLFxyXG4gICAgICAgIHRleHRYMiA9IHJlY3RYICsgdy8yLFxyXG4gICAgICAgIHRleHRYMSA9IHRleHRYMiAtIGgvNCxcclxuICAgICAgICB0ZXh0WDMgPSB0ZXh0WDIgKyBoLzQsXHJcbiAgICAgICAgdGV4dFkgPSByZWN0WSArIGgvMjtcclxuXHJcbiAgICBzZWxmLm1zZ09uID0gZmFsc2U7XHJcblxyXG4gICAgc2VsZi5kcmF3U2NvcmUgPSBmdW5jdGlvbiAoY2VsbHMpIHtcclxuICAgICAgICBn0YEuc2F2ZSgpO1xyXG4gICAgICAgIGfRgS5mb250ID0gZnMgKyBcInB4IGZhbnRhc3lcIjtcclxuICAgICAgICBn0YEudGV4dEJhc2VsaW5lID0gXCJtaWRkbGVcIjtcclxuICAgICAgICBn0YEuZmlsbFN0eWxlID0gXCIjNUExRjAwXCI7XHJcbiAgICAgICAgZ9GBLmxpbmVXaWR0aCA9IDU7XHJcbiAgICAgICAgZ9GBLnN0cm9rZVN0eWxlID0gXCIjRkRFNzkyXCI7XHJcbiAgICAgICAgZ9GBLmZpbGxSZWN0KHJlY3RYLCByZWN0WSwgdywgaCk7XHJcbiAgICAgICAgZ9GBLnN0cm9rZVJlY3QocmVjdFgsIHJlY3RZLCB3LCBoKTtcclxuICAgICAgICBn0YEuZmlsbFN0eWxlID0gXCIjRDE1NzBEXCI7XHJcbiAgICAgICAgZ9GBLnRleHRBbGlnbiA9IFwiZW5kXCI7XHJcbiAgICAgICAgZ9GBLmZpbGxUZXh0KGNlbGxzLm9yYW5nZXMsIHRleHRYMSwgdGV4dFkpO1xyXG4gICAgICAgIGfRgS50ZXh0QWxpZ24gPSBcImNlbnRlclwiO1xyXG4gICAgICAgIGfRgS5maWxsU3R5bGUgPSBcIiNGREU3OTJcIjtcclxuICAgICAgICBn0YEuZmlsbFRleHQoXCI6XCIsIHRleHRYMiwgdGV4dFkpO1xyXG4gICAgICAgIGfRgS50ZXh0QWxpZ24gPSBcInN0YXJ0XCI7XHJcbiAgICAgICAgZ9GBLmZpbGxTdHlsZSA9IFwiIzQ3NzcyNVwiO1xyXG4gICAgICAgIGfRgS5maWxsVGV4dChjZWxscy5ncmVlbnMsIHRleHRYMywgdGV4dFkpO1xyXG4gICAgICAgIGfRgS5yZXN0b3JlKCk7XHJcbiAgICB9O1xyXG4gICAgc2VsZi5kcmF3TWVzc2FnZSA9IGZ1bmN0aW9uIChtKSB7XHJcbiAgICAgICAgc2VsZi5tc2dPbiA9IHRydWU7XHJcbiAgICAgICAgZ9GBLnNhdmUoKTtcclxuICAgICAgICBn0YEuZm9udCA9IGZzLzIgKyBcInB4IGZhbnRhc3lcIjtcclxuICAgICAgICB2YXIgbncgPSBn0YEubWVhc3VyZVRleHQobSkud2lkdGgsXHJcbiAgICAgICAgICAgIG54ID0gKFcgLSBudykvMjtcclxuICAgICAgICBn0YEudGV4dEJhc2VsaW5lID0gXCJtaWRkbGVcIjtcclxuICAgICAgICBn0YEuZmlsbFN0eWxlID0gXCIjNUExRjAwXCI7XHJcbiAgICAgICAgZ9GBLmxpbmVXaWR0aCA9IDU7XHJcbiAgICAgICAgZ9GBLnN0cm9rZVN0eWxlID0gXCIjRkRFNzkyXCI7XHJcbiAgICAgICAgZ9GBLmZpbGxSZWN0KG54LCByZWN0WSwgbncgKyBoLzIsIGgpO1xyXG4gICAgICAgIGfRgS5zdHJva2VSZWN0KG54LCByZWN0WSwgbncgKyBoLzIsIGgpO1xyXG4gICAgICAgIGfRgS5maWxsU3R5bGUgPSBcIiNGREU3OTJcIjtcclxuICAgICAgICBn0YEudGV4dEFsaWduID0gXCJzdGFydFwiO1xyXG4gICAgICAgIGfRgS5maWxsVGV4dChtLCBueCArIGgvNCwgdGV4dFkpO1xyXG4gICAgICAgIGfRgS5yZXN0b3JlKCk7XHJcbiAgICB9O1xyXG59XHJcblxyXG5mdW5jdGlvbiBnZXRFbXB0eUFycmF5KGNvbCwgcm93KSB7XHJcbiAgICB2YXIgYXJyID0gW10sIGkgPSAwLCBqO1xyXG4gICAgZm9yICggOyBpIDwgY29sOyBpKysgKSB7XHJcbiAgICAgICAgYXJyW2ldID0gbmV3IEFycmF5KHJvdyk7XHJcbiAgICAgICAgZm9yICggaiA9IDA7IGogPCByb3c7ICkgeyBhcnJbaV1baisrXSA9IDA7IH1cclxuICAgIH1cclxuICAgIHJldHVybiBhcnI7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGdldFRyaWJlQXJyYXkoY29sLCByb3csIGNmaWxsKSB7XHJcbiAgICB2YXIgaW5pdGFyciA9IGdldEluaXRBcnJheShjb2wsIHJvdywgY2ZpbGwpLFxyXG4gICAgICAgIGFyciA9IFtdLFxyXG4gICAgICAgIGNvbGFycjtcclxuICAgIHdoaWxlICggaW5pdGFyci5sZW5ndGggKSB7XHJcbiAgICAgICAgY29sYXJyID0gaW5pdGFyci5zcGxpY2UoMCwgcm93KTtcclxuICAgICAgICBhcnIucHVzaChjb2xhcnIpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGFycjtcclxufVxyXG5cclxuZnVuY3Rpb24gZ2V0SW5pdEFycmF5KGNvbCwgcm93LCBjZmlsbCkge1xyXG4gICAgdmFyIGVtcHR5ID0gKGNvbCAqIHJvdykgLSBtYXhM0KEsXHJcbiAgICAgICAgZmlsbGVkID0gbmV3IEFycmF5KG1heEzQoSksXHJcbiAgICAgICAgemVyb3MgPSBuZXcgQXJyYXkoZW1wdHkpLFxyXG4gICAgICAgIGFyciwgaTtcclxuICAgIGZvciAoIGkgPSAwOyBpIDwgbWF4TNChOyApIHsgZmlsbGVkW2krK10gPSBjZmlsbDsgfVxyXG4gICAgZm9yICggaSA9IDA7IGkgPCBlbXB0eTsgKSB7IHplcm9zW2krK10gPSAwOyB9XHJcbiAgICBhcnIgPSBmaWxsZWQuY29uY2F0KHplcm9zKTtcclxuICAgIHJldHVybiBzaHVmZmxlKGFycik7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGpvaW5BcnJheXMoYSwgYikge1xyXG4gICAgdmFyIGxlbiA9IGFbMF0ubGVuZ3RoLFxyXG4gICAgICAgIG1pZCA9IG5ldyBBcnJheShsZW4pLFxyXG4gICAgICAgIGogPSAwO1xyXG4gICAgZm9yICggOyBqIDwgbGVuOyApIHsgbWlkW2orK10gPSAwOyB9XHJcbiAgICByZXR1cm4gYS5jb25jYXQoW21pZF0sIGIpO1xyXG59XHJcblxyXG4vLyBUaGUgRmlzaGVyLVlhdGVzIChLbnV0aCkgc2h1ZmZsZSBhbGdvcml0aG1cclxuZnVuY3Rpb24gc2h1ZmZsZShhcnIpIHtcclxuICAgIHZhciBpID0gYXJyLmxlbmd0aCwgcmFuZGk7XHJcbiAgICB3aGlsZSAoIGkgKSB7XHJcbiAgICAgICAgcmFuZGkgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoaS0tKSk7XHJcbiAgICAgICAgYXJyW2ldID0gW2FycltyYW5kaV0sIGFycltyYW5kaV0gPSBhcnJbaV1dWzBdO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGFycjtcclxufVxyXG5cclxuIiwiLyoganNoaW50IHN0cmljdDogZmFsc2UgKi9cclxuXHJcbmZ1bmN0aW9uIGdhbWVJbml0KCkge1xyXG4gICAgYWRkQ2xhc3MocGFuZSwgXCJoaWRkZW5cIik7XHJcbiAgICBpZiAoIGJvdGh0cmliZXMgKSB7XHJcbiAgICAgICAgaWYgKCBncmlkT24gKSB7IGRyYXdHcmlkKFMsIGNvbE4sIHJvd04sIFwiYm90aFwiKTsgfVxyXG4gICAgICAgIGRyYXdTdGFnZShncmVlbkFyciwgXCJyaWdodFwiKTtcclxuICAgICAgICBkcmF3U3RhZ2Uob3JhbmdlQXJyLCBcImxlZnRcIik7XHJcbiAgICAgICAgaW5mb3JtZXIuZHJhd01lc3NhZ2UoXCJIaXQgdGhlIHNwYWNlYmFyIHdoZW4geW91J3JlIGRvbmUuXCIpO1xyXG4gICAgICAgIG1UaW1lb3V0ID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGluZm9ybWVyLm1zZ09uID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGlmICggZ3JpZE9uICkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCBncmlkT24gKSB7IGRyYXdHcmlkKFMsIGNvbE4sIHJvd04sIFwiYm90aFwiKTsgfVxyXG4gICAgICAgICAgICB9ZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBn0YEuY2xlYXJSZWN0KDAsIDAsIFcsIEgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSwgMTAwMCk7XHJcbiAgICB9ZWxzZSB7XHJcbiAgICAgICAgc3RhcnRHYW1lKDIwMDApO1xyXG4gICAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBzdGFydEdhbWUoZGVsYXkpIHtcclxuICAgIGJmMSA9IGdldEVtcHR5QXJyYXkoY29sTiwgcm93Tik7XHJcbiAgICBiZjIgPSBqb2luQXJyYXlzKG9yYW5nZUFyciwgZ3JlZW5BcnIpO1xyXG4gICAgaWYgKCBncmlkT24gKSB7IGRyYXdHcmlkKFMsIGNvbE4sIHJvd04gKTsgfVxyXG4gICAgZHJhd1N0YWdlKGJmMik7XHJcbiAgICBtVGltZW91dCA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHNob3dNdXN0R29PbigpO1xyXG4gICAgfSwgZGVsYXkpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBkcmF3U3RhZ2UoYXJyLCBoYWxmKSB7XHJcbiAgICB2YXIgbGVuID0gYXJyLmxlbmd0aCxcclxuICAgICAgICBpID0gMCwgaiwgYWRkID0gMDtcclxuICAgIGlmICggaGFsZiA9PT0gXCJyaWdodFwiICkge1xyXG4gICAgICAgIGFkZCA9IGhhbGZXICsgUztcclxuICAgIH1cclxuICAgIGZvciAoIDsgaSA8IGxlbjsgaSsrICkge1xyXG4gICAgICAgIGZvciAoIGogPSAwOyBqIDwgcm93TjsgaisrICkge1xyXG4gICAgICAgICAgICBkcmF3Q2VsbChhZGQgKyBpKlMsIGoqUywgYXJyW2ldW2pdKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGRyYXdHcmlkKHMsIG53LCBuaCwgaGFsZikge1xyXG4gICAgdmFyIHcgPSAoIGhhbGYgKSA/IGhhbGZXIDogVyxcclxuICAgICAgICBud2ggPSAoIGhhbGYgKSA/IGNvbEhOICsgMSA6IG53ICsgMSxcclxuICAgICAgICBtLCBhZGQsIGkgPSAwO1xyXG4gICAgZ9GBLnN0cm9rZVN0eWxlID0gQ0xSU1szXTtcclxuICAgIGfRgS5jbGVhclJlY3QoMCwgMCwgVywgSCk7XHJcbiAgICBmb3IgKCA7IGkgPCBud2g7IGkrKyApIHtcclxuICAgICAgICBtID0gaSAqIHM7XHJcbiAgICAgICAgZHJhd0xpbmUobSwgMCwgbSwgSCk7XHJcbiAgICB9XHJcbiAgICBmb3IgKCBpID0gMDsgaSA8IG5oICsgMTsgaSsrICkge1xyXG4gICAgICAgIG0gPSBpICogcztcclxuICAgICAgICBkcmF3TGluZSgwLCBtLCB3LCBtKTtcclxuICAgIH1cclxuICAgIGlmICggaGFsZiA9PT0gXCJib3RoXCIgKSB7XHJcbiAgICAgICAgYWRkID0gaGFsZlcgKyBTO1xyXG4gICAgICAgIGZvciAoIGkgPSAwOyBpIDwgbndoOyBpKysgKSB7XHJcbiAgICAgICAgICAgIG0gPSBhZGQgKyBpICogcztcclxuICAgICAgICAgICAgZHJhd0xpbmUobSwgMCwgbSwgSCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZvciAoIGkgPSAwOyBpIDwgbmggKyAxOyBpKysgKSB7XHJcbiAgICAgICAgICAgIG0gPSBpICogcztcclxuICAgICAgICAgICAgZHJhd0xpbmUoYWRkLCBtLCBhZGQgKyB3LCBtKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGRyYXdMaW5lKHN4LCBzeSwgZngsIGZ5KSB7XHJcbiAgICBn0YEuYmVnaW5QYXRoKCk7XHJcbiAgICBn0YEubW92ZVRvKHN4LCBzeSk7XHJcbiAgICBn0YEubGluZVRvKGZ4LCBmeSk7XHJcbiAgICBn0YEuc3Ryb2tlKCk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGRyYXdDZWxsKHgsIHksIHQpIHtcclxuICAgIGMuZmlsbFN0eWxlID0gQ0xSU1t0XTtcclxuICAgIGMuZmlsbFJlY3QoeCwgeSwgUywgUyk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHNob3dNdXN0R29PbigpIHtcclxuICAgIGlmICggaW5mb3JtZXIubXNnT24gKSB7XHJcbiAgICAgICAgY2xlYXJUaW1lb3V0KG1UaW1lb3V0KTtcclxuICAgICAgICBpbmZvcm1lci5tc2dPbiA9IGZhbHNlO1xyXG4gICAgICAgIGlmICggZ3JpZE9uICkge1xyXG4gICAgICAgICAgICBkcmF3R3JpZChTLCBjb2xOLCByb3dOICk7XHJcbiAgICAgICAgfWVsc2Uge1xyXG4gICAgICAgICAgICBn0YEuY2xlYXJSZWN0KDAsIDAsIFcsIEgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGlmICggYm90aHRyaWJlcyApIHtcclxuICAgICAgICBib3RodHJpYmVzID0gIWJvdGh0cmliZXM7XHJcbiAgICAgICAgc3RhcnRHYW1lKDUwMCk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgYW5pbWF0aW9uID0gIWFuaW1hdGlvbjtcclxuICAgIGlmICggYW5pbWF0aW9uICkgeyByZXF1ZXN0QW5pbWF0aW9uRnJhbWUobmV4dEdlbik7IH1cclxufVxyXG5cclxuZnVuY3Rpb24gbmV4dEdlbigpIHtcclxuICAgIHZhciBpID0gMCwgajtcclxuICAgIGZvciAoIDsgaSA8IGNvbE47IGkrKyApIHtcclxuICAgICAgICBmb3IgKCBqID0gMDsgaiA8IHJvd047IGorKyApIHtcclxuICAgICAgICAgICAgYmYxW2ldW2pdID0gY2FsY1N0YXRlKGksIGopO1xyXG4gICAgICAgICAgICBkcmF3Q2VsbChpKlMsIGoqUywgYmYxW2ldW2pdKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBiZjEgPSBbYmYyLCBiZjIgPSBiZjFdWzBdOyAgIC8vIHN3YXAgdGhlIGFycmF5c1xyXG4gICAgZ2VuZXJhdGlvbisrO1xyXG4gICAgaWYgKCBhbmltYXRpb24gKSB7XHJcbiAgICAgICAgaWYgKCBnZW5lcmF0aW9uID49IG1heEdlbiApIHtcclxuICAgICAgICAgICAgYW5pbWF0aW9uID0gIWFuaW1hdGlvbjtcclxuICAgICAgICAgICAgZGlzcGxheVJlc3VsdHMoKTtcclxuICAgICAgICB9ZWxzZSB7XHJcbiAgICAgICAgICAgIGlmICggZ2VuZXJhdGlvbiUyNSA9PT0gMCApIHtcclxuICAgICAgICAgICAgICAgIGFuaW1hdGlvbiA9IGNoZWNrQ2VsbE51bShiZjEsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgaWYgKCAhYW5pbWF0aW9uICkgeyBkaXNwbGF5UmVzdWx0cygpOyB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKG5leHRHZW4pO1xyXG4gICAgICAgIH1cclxuICAgIH1lbHNlIHtcclxuICAgICAgICBpZiAoIGdlbmVyYXRpb24gPj0gbWF4R2VuICkge1xyXG4gICAgICAgICAgICBkaXNwbGF5UmVzdWx0cygpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5cclxuZnVuY3Rpb24gY2hlY2tTdGF0ZSgpIHtcclxuICAgIGNlbGxudW0gPSBjaGVja0NlbGxOdW0oYmYyKTtcclxuICAgIGluZm9ybWVyLmRyYXdTY29yZShjZWxsbnVtKTtcclxufVxyXG5cclxuZnVuY3Rpb24gZGlzcGxheVJlc3VsdHMoKSB7XHJcbiAgICBjZWxsbnVtID0gY2hlY2tDZWxsTnVtKGJmMik7XHJcbiAgICBpbmZvcm1lci5kcmF3U2NvcmUoY2VsbG51bSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNoZWNrQ2VsbE51bShhcnIsIGNoZWNrKSB7XHJcbiAgICB2YXIgbGVuID0gYXJyLmxlbmd0aCxcclxuICAgICAgICBpID0gMCwgaixcclxuICAgICAgICBvYmogPSB7XHJcbiAgICAgICAgICAgIGRlYWQ6IDAsXHJcbiAgICAgICAgICAgIG9yYW5nZXM6IDAsXHJcbiAgICAgICAgICAgIGdyZWVuczogMFxyXG4gICAgICAgIH07XHJcbiAgICBmb3IgKCA7IGkgPCBsZW47IGkrKyApIHtcclxuICAgICAgICBmb3IgKCBqID0gMDsgaiA8IHJvd047IGorKyApIHtcclxuICAgICAgICAgICAgaWYgKCBhcnJbaV1bal0gKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIGFycltpXVtqXSA9PT0gMSApIHtcclxuICAgICAgICAgICAgICAgICAgICBvYmoub3JhbmdlcysrO1xyXG4gICAgICAgICAgICAgICAgfWVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIG9iai5ncmVlbnMrKztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfWVsc2Uge1xyXG4gICAgICAgICAgICAgICAgb2JqLmRlYWQrKztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBpZiAoIGNoZWNrICkge1xyXG4gICAgICAgIHJldHVybiAhIW9iai5vcmFuZ2VzICYmICEhb2JqLmdyZWVucztcclxuICAgIH1cclxuICAgIHJldHVybiBvYmo7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNhbGNTdGF0ZShpLGopIHtcclxuXHJcbiAgICAvLyBUaGUgYmF0dGxlZmllbGQgZXNzZW50aWFsbHkgaXMgYSB0b3J1cy5cclxuICAgIHZhciBtaSA9ICggaS0xIDwgMCApID8gY29sTi0xIDogaS0xLFxyXG4gICAgICAgIHBpID0gKCBpKzEgPiBjb2xOLTEgKSA/IDAgOiBpKzEsXHJcbiAgICAgICAgbWogPSAoIGotMSA8IDAgKSA/IHJvd04tMSA6IGotMSxcclxuICAgICAgICBwaiA9ICggaisxID4gcm93Ti0xICkgPyAwIDogaisxLFxyXG4gICAgLy8gYWxsIHRoZSBuZWlnaGJvdXJzIGFyZSB3ZWxjb21lIHRvIHRoZSBzcGVjaWFsIGFycmF5XHJcbiAgICAgICAgbmVpZ2hib3VycyA9IFtcclxuICAgICAgICAgICAgYmYyW21pXVttal0sXHJcbiAgICAgICAgICAgIGJmMlttaV1bal0sXHJcbiAgICAgICAgICAgIGJmMlttaV1bcGpdLFxyXG4gICAgICAgICAgICBiZjJbaV1bbWpdLFxyXG4gICAgICAgICAgICBiZjJbaV1bcGpdLFxyXG4gICAgICAgICAgICBiZjJbcGldW21qXSxcclxuICAgICAgICAgICAgYmYyW3BpXVtqXSxcclxuICAgICAgICAgICAgYmYyW3BpXVtwal1cclxuICAgICAgICBdLFxyXG4gICAgICAgIHplcnJvID0gMCwgb25lcyA9IDAsIHR3b3MgPSAwLCB6ID0gMCwgYWxpdmU7XHJcbiAgICBmb3IgKCA7IHo8ODsgeisrICkge1xyXG4gICAgICAgIGlmICggbmVpZ2hib3Vyc1t6XSApIHtcclxuICAgICAgICAgICAgaWYgKCBuZWlnaGJvdXJzW3pdPT09MSApIHtcclxuICAgICAgICAgICAgICAgIG9uZXMrKztcclxuICAgICAgICAgICAgfWVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdHdvcysrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfWVsc2Uge1xyXG4gICAgICAgICAgICB6ZXJybysrO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGFsaXZlID0gb25lcyArIHR3b3M7XHJcbiAgICAvLyB1c3VhbCBydWxlcyBvZiB0aGUgQ29ud2F5J3MgR2FtZSBPZiBMaWZlXHJcblxyXG4gICAgaWYgKCBiZjJbaV1bal0gKSB7XHJcbiAgICAgICAgcmV0dXJuICggYWxpdmU8MiB8fCBhbGl2ZT4zICkgPyAwIDogYmYyW2ldW2pdO1xyXG4gICAgfVxyXG4gICAgLy9idXQgaWYgdGhlIGRlYWQgY2VsbCB3YXMgbWFkZSB0byBjYW1lIHRvIGxpZmUsIGl0IGFwcGVhcnMgYXMgYSBtZW1iZXIgb2YgdGhlIHByZWRvbWluYW50IChpbiB0aGUgbmVpZ2hib3VyaG9vZCkgdHJpYmVcclxuICAgIHJldHVybiAoIGFsaXZlIT09MyApID8gMCA6ICggdHdvcyA+IG9uZXMgKSA/IDIgOiAoIG9uZXMgPiB0d29zICkgPyAxIDogKE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSswLjUpKTtcclxufSIsIi8qIGpzaGludCBzdHJpY3Q6IGZhbHNlICovXHJcblxyXG5iLm9ua2V5dXAgPSBmdW5jdGlvbihlKSB7XHJcbiAgICBzd2l0Y2ggKGUua2V5Q29kZSkge1xyXG4gICAgICAgIGNhc2UgMzI6IHNob3dNdXN0R29PbigpOyBicmVhaztcclxuICAgICAgICBjYXNlIDI3OiBpZiAoICFhbmltYXRpb24gKSB7IGluaXQodHJ1ZSk7IH0gYnJlYWs7XHJcbiAgICAgICAgY2FzZSAzOTogaWYgKCAhYW5pbWF0aW9uICkgeyBuZXh0R2VuKCk7IH0gYnJlYWs7XHJcbiAgICAgICAgY2FzZSAzNzogaWYgKCAhYW5pbWF0aW9uICkgeyBuZXh0R2VuKCk7IH0gYnJlYWs7XHJcbiAgICAgICAgY2FzZSAzODogaWYgKCAhYW5pbWF0aW9uICkgeyBuZXh0R2VuKCk7IH0gYnJlYWs7XHJcbiAgICAgICAgY2FzZSA0MDogaWYgKCAhYW5pbWF0aW9uICkgeyBuZXh0R2VuKCk7IH0gYnJlYWs7XHJcbiAgICB9XHJcbn07XHJcblxyXG5iLm9ubW91c2V1cCA9IGZ1bmN0aW9uKGUpIHtcclxuICAgIGlmICggZS50YXJnZXQubm9kZU5hbWUgPT09IFwiU1BBTlwiICkge1xyXG4gICAgICAgIG9uU3Bhbk1vdXNlVXAoZSk7XHJcbiAgICB9ZWxzZSBpZiAoIGUudGFyZ2V0Lm5vZGVOYW1lID09PSBcIkNBTlZBU1wiICkge1xyXG4gICAgICAgIG9uQ2FudmFzTW91c2VVcChlKTtcclxuICAgIH1lbHNlIGlmICggZS50YXJnZXQubm9kZU5hbWUgPT09IFwiRElWXCIgKSB7XHJcbiAgICAgICAgc3dpdGNoICggZS50YXJnZXQuaWQgKSB7XHJcbiAgICAgICAgICAgIGNhc2UgXCJhcHBseVwiOiAgYXBwbHlDb25maWcoKTsgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgXCJzdGFydFwiOiAgZ2FtZUluaXQoKTsgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgXCJnZW5lcmF0ZVwiOiBnZW5lcmF0ZUFycigpOyBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBcInJlc2V0XCI6IHJlc2V0QXJyKCk7IGJyZWFrO1xyXG4gICAgICAgICAgICBkZWZhdWx0OiByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59O1xyXG5ncmlkLm9ubW91c2Vkb3duID0gb25DYW52YXNNb3VzZURvd247XHJcbmdyaWQub25tb3VzZW1vdmUgPSBvbkNhbnZhc01vdXNlTW92ZTtcclxuXHJcbmZ1bmN0aW9uIGdlbmVyYXRlQXJyKCkge1xyXG4gICAgaWYgKCBib3RodHJpYmVzICkge1xyXG4gICAgICAgIG9yYW5nZUFyciA9IGdldFRyaWJlQXJyYXkoY29sSE4sIHJvd04sIDEpO1xyXG4gICAgICAgIGdyZWVuQXJyID0gZ2V0VHJpYmVBcnJheShjb2xITiwgcm93TiwgMik7XHJcbiAgICAgICAgY2VsbG51bSA9IGNoZWNrQ2VsbE51bShncmVlbkFycik7XHJcbiAgICAgICAgZHJhd1N0YWdlKGdyZWVuQXJyLCBcInJpZ2h0XCIpO1xyXG4gICAgICAgIGRyYXdTdGFnZShvcmFuZ2VBcnIsIFwibGVmdFwiKTtcclxuICAgICAgICBpZiAoIGdyaWRPbiApIHsgZHJhd0dyaWQoUywgY29sTiwgcm93TiwgXCJib3RoXCIpOyB9XHJcbiAgICB9ZWxzZSB7XHJcbiAgICAgICAgb3JhbmdlQXJyID0gZ2V0VHJpYmVBcnJheShjb2xITiwgcm93TiwgMSk7XHJcbiAgICAgICAgZHJhd1N0YWdlKG9yYW5nZUFyciwgXCJsZWZ0XCIpO1xyXG4gICAgICAgIGNlbGxudW0ub3JhbmdlcyA9IGNoZWNrQ2VsbE51bShvcmFuZ2VBcnIpLm9yYW5nZXM7XHJcbiAgICAgICAgaWYgKCBncmlkT24gKSB7IGRyYXdHcmlkKFMsIGNvbE4sIHJvd04sIFwibGVmdFwiKTsgfVxyXG4gICAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiByZXNldEFycigpIHtcclxuICAgIGlmICggYm90aHRyaWJlcyApIHtcclxuICAgICAgICBvcmFuZ2VBcnIgPSBnZXRFbXB0eUFycmF5KGNvbEhOLCByb3dOKTtcclxuICAgICAgICBncmVlbkFyciA9IGdldEVtcHR5QXJyYXkoY29sSE4sIHJvd04pO1xyXG4gICAgICAgIGNlbGxudW0uZ3JlZW5zID0gMDtcclxuICAgICAgICBjZWxsbnVtLm9yYW5nZXMgPSAwO1xyXG4gICAgICAgIGRyYXdTdGFnZShncmVlbkFyciwgXCJyaWdodFwiKTtcclxuICAgICAgICBkcmF3U3RhZ2Uob3JhbmdlQXJyLCBcImxlZnRcIik7XHJcbiAgICAgICAgaWYgKCBncmlkT24gKSB7IGRyYXdHcmlkKFMsIGNvbE4sIHJvd04sIFwiYm90aFwiKTsgfVxyXG4gICAgfWVsc2Uge1xyXG4gICAgICAgIG9yYW5nZUFyciA9IGdldEVtcHR5QXJyYXkoY29sSE4sIHJvd04pO1xyXG4gICAgICAgIGRyYXdTdGFnZShvcmFuZ2VBcnIsIHRydWUpO1xyXG4gICAgICAgIGlmICggZ3JpZE9uICkgeyBkcmF3R3JpZChTLCBjb2xOLCByb3dOLCBcImxlZnRcIik7IH1cclxuICAgIH1cclxufVxyXG5cclxuZnVuY3Rpb24gYXBwbHlDb25maWcoZSkge1xyXG4gICAgY29sTiA9ICtmb3JtLmNvbG51bS52YWx1ZTtcclxuICAgIFAgPSArZm9ybS5wb3BkZW5zLnZhbHVlO1xyXG4gICAgbWF4R2VuID0gK2Zvcm0uZ2VubnVtLnZhbHVlO1xyXG4gICAgZ3JpZE9uID0gK2Zvcm0uc2hvd2dyaWQudmFsdWU7XHJcbiAgICBpbml0KCk7XHJcblxyXG59XHJcblxyXG5mdW5jdGlvbiBvblNwYW5Nb3VzZVVwKGUpIHtcclxuICAgIHZhciBwYW5lbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGUudGFyZ2V0LmlkLnJlcGxhY2UoXCJuYXZcIiwgXCJwYW5lXCIpKSxcclxuICAgICAgICBpID0gMDtcclxuICAgIGlmICggaGFzQ2xhc3MoZS50YXJnZXQsIFwiaW5hY3RpdmUtYnRuXCIpICkge1xyXG4gICAgICAgIGZvciAoIDsgaSA8IG5hdmJ0bnMubGVuZ3RoOyBpKysgKSB7XHJcbiAgICAgICAgICAgIGFkZENsYXNzKG5hdmJ0bnNbaV0sIFwiaW5hY3RpdmUtYnRuXCIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZW1DbGFzcyhlLnRhcmdldCwgXCJpbmFjdGl2ZS1idG5cIik7XHJcbiAgICAgICAgZm9yICggaSA9IDA7IGkgPCBwYW5lbHMubGVuZ3RoOyBpKysgKSB7XHJcbiAgICAgICAgICAgIGFkZENsYXNzKHBhbmVsc1tpXSwgXCJoaWRkZW5cIik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJlbUNsYXNzKHBhbmVsLCBcImhpZGRlblwiKTtcclxuICAgIH1cclxufVxyXG5cclxuZnVuY3Rpb24gb25DYW52YXNNb3VzZVVwKGUpIHtcclxuICAgIGRyYWdnaW5nID0gZmFsc2U7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIG9uQ2FudmFzTW91c2VEb3duKGUpIHtcclxuICAgIGRyYWdnaW5nID0gdHJ1ZTtcclxuICAgIG9uQ2FudmFzTW91c2VNb3ZlKGUpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBvbkNhbnZhc01vdXNlTW92ZShlKSB7XHJcbiAgICBpZiAoIGRyYWdnaW5nICYmICFhbmltYXRpb24gKSB7XHJcbiAgICAgICAgdmFyIG1vdXNlID0gZ2V0UG9pbnRlclBvcyhlLnRhcmdldCwgZSksXHJcbiAgICAgICAgICAgIGkgPSBNYXRoLmZsb29yKG1vdXNlLngvUyksXHJcbiAgICAgICAgICAgIGogPSBNYXRoLmZsb29yKG1vdXNlLnkvUyk7XHJcbiAgICAgICAgaWYgKCBtb3VzZS54IDwgaGFsZlcgKSB7XHJcbiAgICAgICAgICAgIGlmICggIShjYWNoZS5vcmFuZ2VzLmkgPT09IGkgJiYgY2FjaGUub3Jhbmdlcy5qID09PSBqKSApIHtcclxuICAgICAgICAgICAgICAgIG9yYW5nZUFycltpXVtqXSA9ICggb3JhbmdlQXJyW2ldW2pdICkgPyAwIDogMTtcclxuICAgICAgICAgICAgICAgIGlmICggb3JhbmdlQXJyW2ldW2pdICkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNlbGxudW0ub3JhbmdlcysrO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICggY2VsbG51bS5vcmFuZ2VzID4gbWF4TNChICkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjZWxsbnVtLm9yYW5nZXMtLTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb3JhbmdlQXJyW2ldW2pdID0gMDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9ZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2VsbG51bS5vcmFuZ2VzLS07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBjYWNoZS5vcmFuZ2VzLmkgPSBpO1xyXG4gICAgICAgICAgICAgICAgY2FjaGUub3Jhbmdlcy5qID0gajtcclxuICAgICAgICAgICAgICAgIGRyYXdTdGFnZShvcmFuZ2VBcnIsIFwibGVmdFwiKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1lbHNlIGlmICggYm90aHRyaWJlcyAmJiBtb3VzZS54ID4gaGFsZlcgKyBTICkge1xyXG4gICAgICAgICAgICBpIC09IGNvbEhOICsgMTtcclxuICAgICAgICAgICAgaWYgKCAhKGNhY2hlLmdyZWVucy5pID09PSBpICYmIGNhY2hlLmdyZWVucy5qID09PSBqKSApIHtcclxuICAgICAgICAgICAgICAgIGdyZWVuQXJyW2ldW2pdID0gKCBncmVlbkFycltpXVtqXSApID8gMCA6IDI7XHJcbiAgICAgICAgICAgICAgICBpZiAoIGdyZWVuQXJyW2ldW2pdICkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNlbGxudW0uZ3JlZW5zKys7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCBjZWxsbnVtLmdyZWVucyA+IG1heEzQoSApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2VsbG51bS5ncmVlbnMtLTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZ3JlZW5BcnJbaV1bal0gPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1lbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBjZWxsbnVtLmdyZWVucy0tO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgY2FjaGUuZ3JlZW5zLmkgPSBpO1xyXG4gICAgICAgICAgICAgICAgY2FjaGUuZ3JlZW5zLmogPSBqO1xyXG4gICAgICAgICAgICAgICAgZHJhd1N0YWdlKGdyZWVuQXJyLCBcInJpZ2h0XCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBnZXRDZWxsQ29vcmQobW91c2UpIHtcclxuICAgIHZhciBpID0gTWF0aC5yb3VuZChtb3VzZS54L1MpLFxyXG4gICAgICAgIGogPSBNYXRoLnJvdW5kKG1vdXNlLnkvUyk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGhhc0NsYXNzKGVsLCBjbHMpIHtcclxuICAgIHJldHVybiAoXCIgXCIgKyBlbC5jbGFzc05hbWUgKyBcIiBcIikuaW5kZXhPZihcIiBcIiArIGNscyArIFwiIFwiKSA+IC0xO1xyXG59XHJcblxyXG5mdW5jdGlvbiBhZGRDbGFzcyhlbCwgY2xzKSB7XHJcbiAgICBpZiAoIGhhc0NsYXNzKGVsLCBjbHMpICkgeyByZXR1cm47IH1cclxuICAgIGVsLmNsYXNzTmFtZSArPSBcIiBcIiArIGNscztcclxufVxyXG5cclxuZnVuY3Rpb24gcmVtQ2xhc3MoZWwsIGNscykge1xyXG4gICAgZWwuY2xhc3NOYW1lID0gZWwuY2xhc3NOYW1lLnJlcGxhY2UoXCIgXCIgKyBjbHMsIFwiXCIpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBnZXRQb2ludGVyUG9zKGMsIGUpIHtcclxuICAgIHZhciBiY3IgPSBjLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICB4OiBlLnBhZ2VYIC0gYmNyLmxlZnQsXHJcbiAgICAgICAgeTogZS5wYWdlWSAtIGJjci50b3BcclxuICAgIH07XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHBvaW50SW5SZWN0IChwb2ludCwgcmVjdCkge1xyXG4gICAgcmV0dXJuIGluUmFuZ2UocG9pbnQueCwgcmVjdC54LCByZWN0LnggKyByZWN0LncpICYmIGluUmFuZ2UocG9pbnQueSwgcmVjdC55LCByZWN0LnkgKyByZWN0LmgpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBpblJhbmdlICh2YWx1ZSwgbWluLCBtYXgpIHtcclxuICAgIHJldHVybiB2YWx1ZSA+PSBNYXRoLm1pbihtaW4sIG1heCkgJiYgdmFsdWUgPD0gTWF0aC5tYXgobWluLCBtYXgpO1xyXG59XHJcblxyXG5pbml0KCk7Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
function getEl(e){return document.querySelector(e)}function init(e){generation=0,cellnum={},oranges=0,greens=0,dead=0,bothtribes=+form.bothtribes.value,checking=+form.checking.value,maxGen=getGenNumber(+form.gennum.value),S=Math.floor(windowW/colN),rowN=Math.floor(windowH/S),W=S*colN,H=S*rowN,dW=(windowW-W)/2,dH=(windowH-H)/2,colHN=(colN-1)/2,halfW=S*colHN,maxLС=getCellsNumber(P),informer=new Informer,game.width=W,game.height=H,grid.width=W,grid.height=H,game.style.left=dW+"px",game.style.top=dH+"px",grid.style.left=dW+"px",grid.style.top=dH+"px",pane.style.top=dH+"px",pane.style.right=dW+"px",pane.style.width=halfW+"px",pane.style.height=H+"px",form.live.value=maxLС,form.gennumO.value=maxGen.toString(),bothtribes?(orangeArr=getEmptyArray(colHN,rowN),greenArr=getEmptyArray(colHN,rowN),cellnum.greens=0,cellnum.oranges=0):(orangeArr=getEmptyArray(colHN,rowN),greenArr=getTribeArray(colHN,rowN,2),cellnum=checkCellNum(greenArr)),drawStage(orangeArr,"left"),gridOn&&drawGrid(S,colN,rowN,!0),e&&remClass(pane,"hidden")}function getCellsNumber(e){return Math.floor(colHN*rowN*e)}function getGenNumber(e){return e?e:1/0}function Informer(){var e=this,r=H/8,n=r/1.2,a=(H-r)/2,t=a+r/2;e.msgOn=!1,e.drawScore=function(e){var o,g,i,l,s=Math.max(e.oranges,e.greens),c=s+":"+s;gс.save(),gс.font=n+"px fantasy",nw=gс.measureText(c).width+r,o=(W-nw)/2,i=o+nw/2,g=i-r/4,l=i+r/4,gс.textBaseline="middle",gс.fillStyle="#5A1F00",gс.lineWidth=5,gс.strokeStyle="#FDE792",gс.fillRect(o,a,nw,r),gс.strokeRect(o,a,nw,r),gс.fillStyle="#D1570D",gс.textAlign="end",gс.fillText(e.oranges,g,t),gс.textAlign="start",gс.fillStyle="#477725",gс.fillText(e.greens,l,t),gс.textAlign="center",gс.fillStyle="#FDE792",gс.fillText(":",i,t),gс.font=n/2+"px sans-serif",gс.fillText("G"+generation,i,t+n),gс.restore()},e.drawMessage=function(o){e.msgOn=!0,gс.save(),gс.font=n/2+"px sans-serif";var g=gс.measureText(o).width,i=(W-g)/2;gс.textBaseline="middle",gс.fillStyle="#5A1F00",gс.lineWidth=5,gс.strokeStyle="#FDE792",gс.fillRect(i,a,g+r/2,r),gс.strokeRect(i,a,g+r/2,r),gс.fillStyle="#FDE792",gс.textAlign="start",gс.fillText(o,i+r/4,t),gс.restore()}}function getEmptyArray(e,r){for(var n,a=[],t=0;e>t;t++)for(a[t]=new Array(r),n=0;r>n;)a[t][n++]=0;return a}function getTribeArray(e,r,n){for(var a,t=getInitArray(e,r,n),o=[];t.length;)a=t.splice(0,r),o.push(a);return o}function getInitArray(e,r,n){var a,t,o=e*r-maxLС,g=new Array(maxLС),i=new Array(o);for(t=0;maxLС>t;)g[t++]=n;for(t=0;o>t;)i[t++]=0;return a=g.concat(i),shuffle(a)}function joinArrays(e,r){for(var n=e[0].length,a=new Array(n),t=0;n>t;)a[t++]=0;return e.concat([a],r)}function shuffle(e){for(var r,n=e.length;n;)r=Math.floor(Math.random()*n--),e[n]=[e[r],e[r]=e[n]][0];return e}function gameInit(){addClass(pane,"hidden"),gridOn&&drawGrid(S,colN,rowN,"both"),drawStage(greenArr,"right"),drawStage(orangeArr,"left"),informer.drawMessage("Hit the spacebar or any arrowes when you're done."),gamestarted=!0,mTimeout=setTimeout(function(){informer.msgOn=!1,gridOn?gridOn&&drawGrid(S,colN,rowN,"both"):gс.clearRect(0,0,W,H)},1e3)}function startGame(e){bf1=getEmptyArray(colN,rowN),bf2=joinArrays(orangeArr,greenArr),gridOn&&drawGrid(S,colN,rowN),drawStage(bf2),mTimeout=setTimeout(function(){showMustGoOn(e)},1e3)}function drawStage(e,r){var n,a=e.length,t=0,o=0;for("right"===r&&(o=halfW+S);a>t;t++)for(n=0;rowN>n;n++)drawCell(o+t*S,n*S,e[t][n])}function drawGrid(e,r,n,a){var t,o,g=a?halfW:W,i=a?colHN+1:r+1,l=0;for(gс.strokeStyle=CLRS[3],gс.clearRect(0,0,W,H);i>l;l++)t=l*e,drawLine(t,0,t,H);for(l=0;n+1>l;l++)t=l*e,drawLine(0,t,g,t);if("both"===a){for(o=halfW+S,l=0;i>l;l++)t=o+l*e,drawLine(t,0,t,H);for(l=0;n+1>l;l++)t=l*e,drawLine(o,t,o+g,t)}}function drawLine(e,r,n,a){gс.beginPath(),gс.moveTo(e,r),gс.lineTo(n,a),gс.stroke()}function drawCell(e,r,n){c.fillStyle=CLRS[n],c.fillRect(e,r,S,S)}function showMustGoOn(e){informer.msgOn&&(clearTimeout(mTimeout),informer.msgOn=!1,gridOn?drawGrid(S,colN,rowN):gс.clearRect(0,0,W,H)),e?(animation=!animation,animation&&requestAnimationFrame(nextGen)):nextGen()}function nextGen(){for(var e,r=0;colN>r;r++)for(e=0;rowN>e;e++)bf1[r][e]=calcState(r,e),drawCell(r*S,e*S,bf1[r][e]);bf1=[bf2,bf2=bf1][0],generation++,animation?(checking&&(bf2.check&&(animation=checkjson!==JSON.stringify(bf2),bf2.check=!1),generation%25===0&&(animation=checkCellNum(bf2,!0),bf2.check=!0,checkjson=JSON.stringify(bf2)),animation||displayResults()),generation>=maxGen?(animation=!animation,displayResults()):requestAnimationFrame(nextGen)):generation>=maxGen&&displayResults()}function checkState(){cellnum=checkCellNum(bf2),informer.drawScore(cellnum)}function displayResults(){gamestarted=!1,cellnum=checkCellNum(bf2),informer.drawScore(cellnum)}function checkCellNum(e,r){for(var n,a=e.length,t=0,o={dead:0,oranges:0,greens:0};a>t;t++)for(n=0;rowN>n;n++)e[t][n]?1===e[t][n]?o.oranges++:o.greens++:o.dead++;return r?!!o.oranges&&!!o.greens:o}function calcState(e,r){for(var n,a=0>e-1?colN-1:e-1,t=e+1>colN-1?0:e+1,o=0>r-1?rowN-1:r-1,g=r+1>rowN-1?0:r+1,i=[bf2[a][o],bf2[a][r],bf2[a][g],bf2[e][o],bf2[e][g],bf2[t][o],bf2[t][r],bf2[t][g]],l=0,s=0,c=0,f=0;8>f;f++)i[f]?1===i[f]?s++:c++:l++;return n=s+c,bf2[e][r]?2>n||n>3?0:bf2[e][r]:3!==n?0:c>s?2:s>c?1:Math.floor(Math.random()+.5)}function onArrowPress(){gamestarted&&!animation&&maxGen>generation&&(generation?nextGen():startGame())}function onSpaceBarPress(){gamestarted&&maxGen>generation&&(generation?showMustGoOn(!0):startGame(!0))}function generateArr(){bothtribes?(orangeArr=getTribeArray(colHN,rowN,1),greenArr=getTribeArray(colHN,rowN,2),cellnum=checkCellNum(greenArr),drawStage(greenArr,"right"),drawStage(orangeArr,"left"),gridOn&&drawGrid(S,colN,rowN,"both")):(orangeArr=getTribeArray(colHN,rowN,1),drawStage(orangeArr,"left"),cellnum.oranges=checkCellNum(orangeArr).oranges,gridOn&&drawGrid(S,colN,rowN,"left"))}function resetArr(){bothtribes?(orangeArr=getEmptyArray(colHN,rowN),greenArr=getEmptyArray(colHN,rowN),cellnum.greens=0,cellnum.oranges=0,drawStage(greenArr,"right"),drawStage(orangeArr,"left"),gridOn&&drawGrid(S,colN,rowN,"both")):(orangeArr=getEmptyArray(colHN,rowN),drawStage(orangeArr,!0),gridOn&&drawGrid(S,colN,rowN,"left"))}function applyConfig(){for(var e=form.getElementsByTagName("p"),r=0;r<e.length;r++)e[r].style.opacity=1;colN=+form.colnum.value,P=+form.popdens.value,maxGen=+form.gennum.value,gridOn=+form.showgrid.value,init()}function onSpanMouseUp(e){var r=document.getElementById(e.target.id.replace("nav","pane")),n=0;if(hasClass(e.target,"inactive-btn")){for(;n<navbtns.length;n++)addClass(navbtns[n],"inactive-btn");for(remClass(e.target,"inactive-btn"),n=0;n<panels.length;n++)addClass(panels[n],"hidden");remClass(r,"hidden")}}function onCanvasMouseUp(){dragging=!1}function onCanvasMouseDown(e){dragging=!0,onCanvasMouseMove(e)}function onCanvasMouseMove(e){if(dragging&&!generation){var r=getPointerPos(e.target,e),n=Math.floor(r.x/S),a=Math.floor(r.y/S);r.x<halfW?(cache.oranges.i!==n||cache.oranges.j!==a)&&(orangeArr[n][a]=orangeArr[n][a]?0:1,orangeArr[n][a]?(cellnum.oranges++,cellnum.oranges>maxLС&&(cellnum.oranges--,orangeArr[n][a]=0)):cellnum.oranges--,cache.oranges.i=n,cache.oranges.j=a,drawStage(orangeArr,"left")):bothtribes&&r.x>halfW+S&&(n-=colHN+1,(cache.greens.i!==n||cache.greens.j!==a)&&(greenArr[n][a]=greenArr[n][a]?0:2,greenArr[n][a]?(cellnum.greens++,cellnum.greens>maxLС&&(cellnum.greens--,greenArr[n][a]=0)):cellnum.greens--,cache.greens.i=n,cache.greens.j=a,drawStage(greenArr,"right")))}}function getCellCoord(e){Math.round(e.x/S),Math.round(e.y/S)}function hasClass(e,r){return(" "+e.className+" ").indexOf(" "+r+" ")>-1}function addClass(e,r){hasClass(e,r)||(e.className+=" "+r)}function remClass(e,r){e.className=e.className.replace(" "+r,"")}function getPointerPos(e,r){var n=e.getBoundingClientRect();return{x:r.pageX-n.left,y:r.pageY-n.top}}function pointInRect(e,r){return inRange(e.x,r.x,r.x+r.w)&&inRange(e.y,r.y,r.y+r.h)}function inRange(e,r,n){return e>=Math.min(r,n)&&e<=Math.max(r,n)}var colN=51,P=.5,S,rowN,orangeArr,playerLC,greenArr,enemyLC,bf1,bf2,maxLС,W,H,dW,dH,halfW,colHN,maxGen,CLRS=["#5A1F00","#D1570D","#477725","rgba(0,0,0,1)"],animation=!1,gridOn=!0,cache={greens:{i:1e3,j:1e3},oranges:{i:1e3,j:1e3}},checkjson,checking,gamestarted,mTimeout,bothtribes,dragging,cellnum,oranges,greens,dead,generation,game=getEl("#game"),grid=getEl("#grid"),pane=getEl("#pane"),apply=getEl("#apply"),rulesBtn=getEl("#nav-rules"),optionBtn=getEl("#nav-option"),navbtns=document.getElementsByClassName("btn"),panels=document.getElementsByClassName("panels"),form=document.forms[0],c=game.getContext("2d"),gс=grid.getContext("2d"),b=document.body,windowW=window.innerWidth,windowH=window.innerHeight,informer;b.onkeyup=function(e){switch(e.keyCode){case 32:onSpaceBarPress();break;case 27:animation||init(!0);break;case 39:onArrowPress();break;case 37:onArrowPress();break;case 38:onArrowPress();break;case 40:onArrowPress()}},b.onmouseup=function(e){if("SPAN"===e.target.nodeName)onSpanMouseUp(e);else if("CANVAS"===e.target.nodeName)onCanvasMouseUp(e);else if("DIV"===e.target.nodeName)switch(e.target.id){case"apply":applyConfig();break;case"start":gameInit();break;case"generate":generateArr();break;case"reset":resetArr();break;default:return!1}},grid.onmousedown=onCanvasMouseDown,grid.onmousemove=onCanvasMouseMove,init();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBwLm1pbi5qcyIsInNvdXJjZXMiOlsiYS5qcyIsImIuanMiLCJjLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQXNDQSxRQUFBLE9BQUEsR0FBQSxNQUFBLFVBQUEsY0FBQSxHQWtCQSxRQUFBLE1BQUEsR0FDQSxXQUFBLEVBQ0EsV0FDQSxRQUFBLEVBQ0EsT0FBQSxFQUNBLEtBQUEsRUFDQSxZQUFBLEtBQUEsV0FBQSxNQUNBLFVBQUEsS0FBQSxTQUFBLE1BQ0EsT0FBQSxjQUFBLEtBQUEsT0FBQSxPQUNBLEVBQUEsS0FBQSxNQUFBLFFBQUEsTUFDQSxLQUFBLEtBQUEsTUFBQSxRQUFBLEdBQ0EsRUFBQSxFQUFBLEtBQ0EsRUFBQSxFQUFBLEtBQ0EsSUFBQSxRQUFBLEdBQUEsRUFDQSxJQUFBLFFBQUEsR0FBQSxFQUNBLE9BQUEsS0FBQSxHQUFBLEVBQ0EsTUFBQSxFQUFBLE1BQ0EsTUFBQSxlQUFBLEdBQ0EsU0FBQSxHQUFBLFVBRUEsS0FBQSxNQUFBLEVBQ0EsS0FBQSxPQUFBLEVBQ0EsS0FBQSxNQUFBLEVBQ0EsS0FBQSxPQUFBLEVBQ0EsS0FBQSxNQUFBLEtBQUEsR0FBQSxLQUNBLEtBQUEsTUFBQSxJQUFBLEdBQUEsS0FDQSxLQUFBLE1BQUEsS0FBQSxHQUFBLEtBQ0EsS0FBQSxNQUFBLElBQUEsR0FBQSxLQUVBLEtBQUEsTUFBQSxJQUFBLEdBQUEsS0FDQSxLQUFBLE1BQUEsTUFBQSxHQUFBLEtBQ0EsS0FBQSxNQUFBLE1BQUEsTUFBQSxLQUNBLEtBQUEsTUFBQSxPQUFBLEVBQUEsS0FDQSxLQUFBLEtBQUEsTUFBQSxNQUNBLEtBQUEsUUFBQSxNQUFBLE9BQUEsV0FFQSxZQUNBLFVBQUEsY0FBQSxNQUFBLE1BQ0EsU0FBQSxjQUFBLE1BQUEsTUFDQSxRQUFBLE9BQUEsRUFDQSxRQUFBLFFBQUEsSUFFQSxVQUFBLGNBQUEsTUFBQSxNQUNBLFNBQUEsY0FBQSxNQUFBLEtBQUEsR0FDQSxRQUFBLGFBQUEsV0FHQSxVQUFBLFVBQUEsUUFFQSxRQUFBLFNBQUEsRUFBQSxLQUFBLE1BQUEsR0FDQSxHQUFBLFNBQUEsS0FBQSxVQUdBLFFBQUEsZ0JBQUEsR0FDQSxNQUFBLE1BQUEsTUFBQSxNQUFBLEtBQUEsR0FHQSxRQUFBLGNBQUEsR0FDQSxNQUFBLEdBQUEsRUFBQSxJQUdBLFFBQUEsWUFDQSxHQUFBLEdBQUEsS0FDQSxFQUFBLEVBQUEsRUFDQSxFQUFBLEVBQUEsSUFDQSxHQUFBLEVBQUEsR0FBQSxFQUNBLEVBQUEsRUFBQSxFQUFBLENBQ0EsR0FBQSxPQUFBLEVBQ0EsRUFBQSxVQUFBLFNBQUEsR0FDQSxHQUVBLEdBQUEsRUFBQSxFQUFBLEVBRkEsRUFBQSxLQUFBLElBQUEsRUFBQSxRQUFBLEVBQUEsUUFDQSxFQUFBLEVBQUEsSUFBQSxDQUVBLElBQUEsT0FDQSxHQUFBLEtBQUEsRUFBQSxhQUNBLEdBQUEsR0FBQSxZQUFBLEdBQUEsTUFBQSxFQUNBLEdBQUEsRUFBQSxJQUFBLEVBQ0EsRUFBQSxFQUFBLEdBQUEsRUFDQSxFQUFBLEVBQUEsRUFBQSxFQUNBLEVBQUEsRUFBQSxFQUFBLEVBQ0EsR0FBQSxhQUFBLFNBQ0EsR0FBQSxVQUFBLFVBQ0EsR0FBQSxVQUFBLEVBQ0EsR0FBQSxZQUFBLFVBQ0EsR0FBQSxTQUFBLEVBQUEsRUFBQSxHQUFBLEdBQ0EsR0FBQSxXQUFBLEVBQUEsRUFBQSxHQUFBLEdBQ0EsR0FBQSxVQUFBLFVBQ0EsR0FBQSxVQUFBLE1BQ0EsR0FBQSxTQUFBLEVBQUEsUUFBQSxFQUFBLEdBQ0EsR0FBQSxVQUFBLFFBQ0EsR0FBQSxVQUFBLFVBQ0EsR0FBQSxTQUFBLEVBQUEsT0FBQSxFQUFBLEdBQ0EsR0FBQSxVQUFBLFNBQ0EsR0FBQSxVQUFBLFVBQ0EsR0FBQSxTQUFBLElBQUEsRUFBQSxHQUNBLEdBQUEsS0FBQSxFQUFBLEVBQUEsZ0JBQ0EsR0FBQSxTQUFBLElBQUEsV0FBQSxFQUFBLEVBQUEsR0FFQSxHQUFBLFdBRUEsRUFBQSxZQUFBLFNBQUEsR0FDQSxFQUFBLE9BQUEsRUFDQSxHQUFBLE9BQ0EsR0FBQSxLQUFBLEVBQUEsRUFBQSxlQUNBLElBQUEsR0FBQSxHQUFBLFlBQUEsR0FBQSxNQUNBLEdBQUEsRUFBQSxHQUFBLENBQ0EsSUFBQSxhQUFBLFNBQ0EsR0FBQSxVQUFBLFVBQ0EsR0FBQSxVQUFBLEVBQ0EsR0FBQSxZQUFBLFVBQ0EsR0FBQSxTQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxHQUNBLEdBQUEsV0FBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsR0FDQSxHQUFBLFVBQUEsVUFDQSxHQUFBLFVBQUEsUUFDQSxHQUFBLFNBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxHQUNBLEdBQUEsV0FJQSxRQUFBLGVBQUEsRUFBQSxHQUVBLElBREEsR0FBQSxHQUFBLEtBQUEsRUFBQSxFQUNBLEVBQUEsRUFBQSxJQUVBLElBREEsRUFBQSxHQUFBLEdBQUEsT0FBQSxHQUNBLEVBQUEsRUFBQSxFQUFBLEdBQUEsRUFBQSxHQUFBLEtBQUEsQ0FFQSxPQUFBLEdBR0EsUUFBQSxlQUFBLEVBQUEsRUFBQSxHQUlBLElBSEEsR0FFQSxHQUZBLEVBQUEsYUFBQSxFQUFBLEVBQUEsR0FDQSxLQUVBLEVBQUEsUUFDQSxFQUFBLEVBQUEsT0FBQSxFQUFBLEdBQ0EsRUFBQSxLQUFBLEVBRUEsT0FBQSxHQUdBLFFBQUEsY0FBQSxFQUFBLEVBQUEsR0FDQSxHQUdBLEdBQUEsRUFIQSxFQUFBLEVBQUEsRUFBQSxNQUNBLEVBQUEsR0FBQSxPQUFBLE9BQ0EsRUFBQSxHQUFBLE9BQUEsRUFFQSxLQUFBLEVBQUEsRUFBQSxNQUFBLEdBQUEsRUFBQSxLQUFBLENBQ0EsS0FBQSxFQUFBLEVBQUEsRUFBQSxHQUFBLEVBQUEsS0FBQSxDQUVBLE9BREEsR0FBQSxFQUFBLE9BQUEsR0FDQSxRQUFBLEdBR0EsUUFBQSxZQUFBLEVBQUEsR0FJQSxJQUhBLEdBQUEsR0FBQSxFQUFBLEdBQUEsT0FDQSxFQUFBLEdBQUEsT0FBQSxHQUNBLEVBQUEsRUFDQSxFQUFBLEdBQUEsRUFBQSxLQUFBLENBQ0EsT0FBQSxHQUFBLFFBQUEsR0FBQSxHQUlBLFFBQUEsU0FBQSxHQUVBLElBREEsR0FBQSxHQUFBLEVBQUEsRUFBQSxPQUNBLEdBQ0EsRUFBQSxLQUFBLE1BQUEsS0FBQSxTQUFBLEtBQ0EsRUFBQSxJQUFBLEVBQUEsR0FBQSxFQUFBLEdBQUEsRUFBQSxJQUFBLEVBRUEsT0FBQSxHQzFOQSxRQUFBLFlBQ0EsU0FBQSxLQUFBLFVBQ0EsUUFBQSxTQUFBLEVBQUEsS0FBQSxLQUFBLFFBQ0EsVUFBQSxTQUFBLFNBQ0EsVUFBQSxVQUFBLFFBQ0EsU0FBQSxZQUFBLHFEQUNBLGFBQUEsRUFDQSxTQUFBLFdBQUEsV0FDQSxTQUFBLE9BQUEsRUFDQSxPQUNBLFFBQUEsU0FBQSxFQUFBLEtBQUEsS0FBQSxRQUVBLEdBQUEsVUFBQSxFQUFBLEVBQUEsRUFBQSxJQUVBLEtBR0EsUUFBQSxXQUFBLEdBQ0EsSUFBQSxjQUFBLEtBQUEsTUFDQSxJQUFBLFdBQUEsVUFBQSxVQUNBLFFBQUEsU0FBQSxFQUFBLEtBQUEsTUFDQSxVQUFBLEtBQ0EsU0FBQSxXQUFBLFdBRUEsYUFBQSxJQUNBLEtBR0EsUUFBQSxXQUFBLEVBQUEsR0FDQSxHQUNBLEdBREEsRUFBQSxFQUFBLE9BQ0EsRUFBQSxFQUFBLEVBQUEsQ0FJQSxLQUhBLFVBQUEsSUFDQSxFQUFBLE1BQUEsR0FFQSxFQUFBLEVBQUEsSUFDQSxJQUFBLEVBQUEsRUFBQSxLQUFBLEVBQUEsSUFDQSxTQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEdBQUEsSUFLQSxRQUFBLFVBQUEsRUFBQSxFQUFBLEVBQUEsR0FDQSxHQUVBLEdBQUEsRUFGQSxFQUFBLEVBQUEsTUFBQSxFQUNBLEVBQUEsRUFBQSxNQUFBLEVBQUEsRUFBQSxFQUNBLEVBQUEsQ0FHQSxLQUZBLEdBQUEsWUFBQSxLQUFBLEdBQ0EsR0FBQSxVQUFBLEVBQUEsRUFBQSxFQUFBLEdBQ0EsRUFBQSxFQUFBLElBQ0EsRUFBQSxFQUFBLEVBQ0EsU0FBQSxFQUFBLEVBQUEsRUFBQSxFQUVBLEtBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLElBQ0EsRUFBQSxFQUFBLEVBQ0EsU0FBQSxFQUFBLEVBQUEsRUFBQSxFQUVBLElBQUEsU0FBQSxFQUFBLENBRUEsSUFEQSxFQUFBLE1BQUEsRUFDQSxFQUFBLEVBQUEsRUFBQSxFQUFBLElBQ0EsRUFBQSxFQUFBLEVBQUEsRUFDQSxTQUFBLEVBQUEsRUFBQSxFQUFBLEVBRUEsS0FBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsSUFDQSxFQUFBLEVBQUEsRUFDQSxTQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsSUFLQSxRQUFBLFVBQUEsRUFBQSxFQUFBLEVBQUEsR0FDQSxHQUFBLFlBQ0EsR0FBQSxPQUFBLEVBQUEsR0FDQSxHQUFBLE9BQUEsRUFBQSxHQUNBLEdBQUEsU0FHQSxRQUFBLFVBQUEsRUFBQSxFQUFBLEdBQ0EsRUFBQSxVQUFBLEtBQUEsR0FDQSxFQUFBLFNBQUEsRUFBQSxFQUFBLEVBQUEsR0FHQSxRQUFBLGNBQUEsR0FDQSxTQUFBLFFBQ0EsYUFBQSxVQUNBLFNBQUEsT0FBQSxFQUNBLE9BQ0EsU0FBQSxFQUFBLEtBQUEsTUFFQSxHQUFBLFVBQUEsRUFBQSxFQUFBLEVBQUEsSUFHQSxHQUdBLFdBQUEsVUFDQSxXQUFBLHNCQUFBLFVBSEEsVUFPQSxRQUFBLFdBRUEsSUFEQSxHQUFBLEdBQUEsRUFBQSxFQUNBLEtBQUEsRUFBQSxJQUNBLElBQUEsRUFBQSxFQUFBLEtBQUEsRUFBQSxJQUNBLElBQUEsR0FBQSxHQUFBLFVBQUEsRUFBQSxHQUNBLFNBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxJQUFBLEdBQUEsR0FHQSxNQUFBLElBQUEsSUFBQSxLQUFBLEdBQ0EsYUFFQSxXQUNBLFdBQ0EsSUFBQSxRQUNBLFVBQUEsWUFBQSxLQUFBLFVBQUEsS0FDQSxJQUFBLE9BQUEsR0FFQSxXQUFBLEtBQUEsSUFDQSxVQUFBLGFBQUEsS0FBQSxHQUNBLElBQUEsT0FBQSxFQUNBLFVBQUEsS0FBQSxVQUFBLE1BRUEsV0FBQSxrQkFFQSxZQUFBLFFBQ0EsV0FBQSxVQUNBLGtCQUVBLHNCQUFBLFVBR0EsWUFBQSxRQUNBLGlCQUtBLFFBQUEsY0FDQSxRQUFBLGFBQUEsS0FDQSxTQUFBLFVBQUEsU0FHQSxRQUFBLGtCQUNBLGFBQUEsRUFDQSxRQUFBLGFBQUEsS0FDQSxTQUFBLFVBQUEsU0FHQSxRQUFBLGNBQUEsRUFBQSxHQVFBLElBUEEsR0FDQSxHQURBLEVBQUEsRUFBQSxPQUNBLEVBQUEsRUFDQSxHQUNBLEtBQUEsRUFDQSxRQUFBLEVBQ0EsT0FBQSxHQUVBLEVBQUEsRUFBQSxJQUNBLElBQUEsRUFBQSxFQUFBLEtBQUEsRUFBQSxJQUNBLEVBQUEsR0FBQSxHQUNBLElBQUEsRUFBQSxHQUFBLEdBQ0EsRUFBQSxVQUVBLEVBQUEsU0FHQSxFQUFBLE1BS0EsT0FBQSxLQUNBLEVBQUEsV0FBQSxFQUFBLE9BRUEsRUFHQSxRQUFBLFdBQUEsRUFBQSxHQW1CQSxJQWhCQSxHQWVBLEdBZkEsRUFBQSxFQUFBLEVBQUEsRUFBQSxLQUFBLEVBQUEsRUFBQSxFQUNBLEVBQUEsRUFBQSxFQUFBLEtBQUEsRUFBQSxFQUFBLEVBQUEsRUFDQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEtBQUEsRUFBQSxFQUFBLEVBQ0EsRUFBQSxFQUFBLEVBQUEsS0FBQSxFQUFBLEVBQUEsRUFBQSxFQUVBLEdBQ0EsSUFBQSxHQUFBLEdBQ0EsSUFBQSxHQUFBLEdBQ0EsSUFBQSxHQUFBLEdBQ0EsSUFBQSxHQUFBLEdBQ0EsSUFBQSxHQUFBLEdBQ0EsSUFBQSxHQUFBLEdBQ0EsSUFBQSxHQUFBLEdBQ0EsSUFBQSxHQUFBLElBRUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxFQUNBLEVBQUEsRUFBQSxJQUNBLEVBQUEsR0FDQSxJQUFBLEVBQUEsR0FDQSxJQUVBLElBR0EsR0FNQSxPQUhBLEdBQUEsRUFBQSxFQUdBLElBQUEsR0FBQSxHQUNBLEVBQUEsR0FBQSxFQUFBLEVBQUEsRUFBQSxJQUFBLEdBQUEsR0FHQSxJQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxLQUFBLE1BQUEsS0FBQSxTQUFBLElDeE1BLFFBQUEsZ0JBQ0EsY0FBQSxXQUFBLE9BQUEsYUFDQSxXQUdBLFVBRkEsYUFPQSxRQUFBLG1CQUNBLGFBQUEsT0FBQSxhQUNBLFdBR0EsY0FBQSxHQUZBLFdBQUEsSUEwQkEsUUFBQSxlQUNBLFlBQ0EsVUFBQSxjQUFBLE1BQUEsS0FBQSxHQUNBLFNBQUEsY0FBQSxNQUFBLEtBQUEsR0FDQSxRQUFBLGFBQUEsVUFDQSxVQUFBLFNBQUEsU0FDQSxVQUFBLFVBQUEsUUFDQSxRQUFBLFNBQUEsRUFBQSxLQUFBLEtBQUEsVUFFQSxVQUFBLGNBQUEsTUFBQSxLQUFBLEdBQ0EsVUFBQSxVQUFBLFFBQ0EsUUFBQSxRQUFBLGFBQUEsV0FBQSxRQUNBLFFBQUEsU0FBQSxFQUFBLEtBQUEsS0FBQSxTQUlBLFFBQUEsWUFDQSxZQUNBLFVBQUEsY0FBQSxNQUFBLE1BQ0EsU0FBQSxjQUFBLE1BQUEsTUFDQSxRQUFBLE9BQUEsRUFDQSxRQUFBLFFBQUEsRUFDQSxVQUFBLFNBQUEsU0FDQSxVQUFBLFVBQUEsUUFDQSxRQUFBLFNBQUEsRUFBQSxLQUFBLEtBQUEsVUFFQSxVQUFBLGNBQUEsTUFBQSxNQUNBLFVBQUEsV0FBQSxHQUNBLFFBQUEsU0FBQSxFQUFBLEtBQUEsS0FBQSxTQUlBLFFBQUEsZUFHQSxJQUZBLEdBQUEsR0FBQSxLQUFBLHFCQUFBLEtBQ0EsRUFBQSxFQUNBLEVBQUEsRUFBQSxPQUFBLElBQUEsRUFBQSxHQUFBLE1BQUEsUUFBQSxDQUNBLE9BQUEsS0FBQSxPQUFBLE1BQ0EsR0FBQSxLQUFBLFFBQUEsTUFDQSxRQUFBLEtBQUEsT0FBQSxNQUNBLFFBQUEsS0FBQSxTQUFBLE1BQ0EsT0FJQSxRQUFBLGVBQUEsR0FDQSxHQUFBLEdBQUEsU0FBQSxlQUFBLEVBQUEsT0FBQSxHQUFBLFFBQUEsTUFBQSxTQUNBLEVBQUEsQ0FDQSxJQUFBLFNBQUEsRUFBQSxPQUFBLGdCQUFBLENBQ0EsS0FBQSxFQUFBLFFBQUEsT0FBQSxJQUNBLFNBQUEsUUFBQSxHQUFBLGVBR0EsS0FEQSxTQUFBLEVBQUEsT0FBQSxnQkFDQSxFQUFBLEVBQUEsRUFBQSxPQUFBLE9BQUEsSUFDQSxTQUFBLE9BQUEsR0FBQSxTQUVBLFVBQUEsRUFBQSxXQUlBLFFBQUEsbUJBQ0EsVUFBQSxFQUdBLFFBQUEsbUJBQUEsR0FDQSxVQUFBLEVBQ0Esa0JBQUEsR0FHQSxRQUFBLG1CQUFBLEdBQ0EsR0FBQSxXQUFBLFdBQUEsQ0FDQSxHQUFBLEdBQUEsY0FBQSxFQUFBLE9BQUEsR0FDQSxFQUFBLEtBQUEsTUFBQSxFQUFBLEVBQUEsR0FDQSxFQUFBLEtBQUEsTUFBQSxFQUFBLEVBQUEsRUFDQSxHQUFBLEVBQUEsT0FDQSxNQUFBLFFBQUEsSUFBQSxHQUFBLE1BQUEsUUFBQSxJQUFBLEtBQ0EsVUFBQSxHQUFBLEdBQUEsVUFBQSxHQUFBLEdBQUEsRUFBQSxFQUNBLFVBQUEsR0FBQSxJQUNBLFFBQUEsVUFDQSxRQUFBLFFBQUEsUUFDQSxRQUFBLFVBQ0EsVUFBQSxHQUFBLEdBQUEsSUFHQSxRQUFBLFVBRUEsTUFBQSxRQUFBLEVBQUEsRUFDQSxNQUFBLFFBQUEsRUFBQSxFQUNBLFVBQUEsVUFBQSxTQUVBLFlBQUEsRUFBQSxFQUFBLE1BQUEsSUFDQSxHQUFBLE1BQUEsR0FDQSxNQUFBLE9BQUEsSUFBQSxHQUFBLE1BQUEsT0FBQSxJQUFBLEtBQ0EsU0FBQSxHQUFBLEdBQUEsU0FBQSxHQUFBLEdBQUEsRUFBQSxFQUNBLFNBQUEsR0FBQSxJQUNBLFFBQUEsU0FDQSxRQUFBLE9BQUEsUUFDQSxRQUFBLFNBQ0EsU0FBQSxHQUFBLEdBQUEsSUFHQSxRQUFBLFNBRUEsTUFBQSxPQUFBLEVBQUEsRUFDQSxNQUFBLE9BQUEsRUFBQSxFQUNBLFVBQUEsU0FBQSxZQU1BLFFBQUEsY0FBQSxHQUNBLEtBQUEsTUFBQSxFQUFBLEVBQUEsR0FDQSxLQUFBLE1BQUEsRUFBQSxFQUFBLEdBR0EsUUFBQSxVQUFBLEVBQUEsR0FDQSxPQUFBLElBQUEsRUFBQSxVQUFBLEtBQUEsUUFBQSxJQUFBLEVBQUEsS0FBQSxHQUdBLFFBQUEsVUFBQSxFQUFBLEdBQ0EsU0FBQSxFQUFBLEtBQ0EsRUFBQSxXQUFBLElBQUEsR0FHQSxRQUFBLFVBQUEsRUFBQSxHQUNBLEVBQUEsVUFBQSxFQUFBLFVBQUEsUUFBQSxJQUFBLEVBQUEsSUFHQSxRQUFBLGVBQUEsRUFBQSxHQUNBLEdBQUEsR0FBQSxFQUFBLHVCQUNBLFFBQ0EsRUFBQSxFQUFBLE1BQUEsRUFBQSxLQUNBLEVBQUEsRUFBQSxNQUFBLEVBQUEsS0FJQSxRQUFBLGFBQUEsRUFBQSxHQUNBLE1BQUEsU0FBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLElBQUEsUUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEdBR0EsUUFBQSxTQUFBLEVBQUEsRUFBQSxHQUNBLE1BQUEsSUFBQSxLQUFBLElBQUEsRUFBQSxJQUFBLEdBQUEsS0FBQSxJQUFBLEVBQUEsR0ZoTUEsR0FBQSxNQUFBLEdBQ0EsRUFBQSxHQUNBLEVBQ0EsS0FDQSxVQUNBLFNBQ0EsU0FDQSxRQUNBLElBQ0EsSUFDQSxNQUNBLEVBQUEsRUFBQSxHQUFBLEdBQUEsTUFBQSxNQUFBLE9BQ0EsTUFBQSxVQUFBLFVBQUEsVUFBQSxpQkFDQSxXQUFBLEVBQ0EsUUFBQSxFQUNBLE9BQ0EsUUFDQSxFQUFBLElBQ0EsRUFBQSxLQUVBLFNBQ0EsRUFBQSxJQUNBLEVBQUEsTUFHQSxVQUNBLFNBQ0EsWUFDQSxTQUNBLFdBQ0EsU0FDQSxRQUNBLFFBQ0EsT0FDQSxLQUNBLFdBSUEsS0FBQSxNQUFBLFNBQ0EsS0FBQSxNQUFBLFNBQ0EsS0FBQSxNQUFBLFNBQ0EsTUFBQSxNQUFBLFVBQ0EsU0FBQSxNQUFBLGNBQ0EsVUFBQSxNQUFBLGVBQ0EsUUFBQSxTQUFBLHVCQUFBLE9BQ0EsT0FBQSxTQUFBLHVCQUFBLFVBQ0EsS0FBQSxTQUFBLE1BQUEsR0FDQSxFQUFBLEtBQUEsV0FBQSxNQUNBLEdBQUEsS0FBQSxXQUFBLE1BQ0EsRUFBQSxTQUFBLEtBQ0EsUUFBQSxPQUFBLFdBQ0EsUUFBQSxPQUFBLFlBQ0EsUUVwREEsR0FBQSxRQUFBLFNBQUEsR0FDQSxPQUFBLEVBQUEsU0FDQSxJQUFBLElBQUEsaUJBQUEsTUFDQSxLQUFBLElBQUEsV0FBQSxNQUFBLEVBQUEsTUFDQSxLQUFBLElBQUEsY0FBQSxNQUNBLEtBQUEsSUFBQSxjQUFBLE1BQ0EsS0FBQSxJQUFBLGNBQUEsTUFDQSxLQUFBLElBQUEsaUJBd0JBLEVBQUEsVUFBQSxTQUFBLEdBQ0EsR0FBQSxTQUFBLEVBQUEsT0FBQSxTQUNBLGNBQUEsT0FDQSxJQUFBLFdBQUEsRUFBQSxPQUFBLFNBQ0EsZ0JBQUEsT0FDQSxJQUFBLFFBQUEsRUFBQSxPQUFBLFNBQ0EsT0FBQSxFQUFBLE9BQUEsSUFDQSxJQUFBLFFBQUEsYUFBQSxNQUNBLEtBQUEsUUFBQSxVQUFBLE1BQ0EsS0FBQSxXQUFBLGFBQUEsTUFDQSxLQUFBLFFBQUEsVUFBQSxNQUNBLFNBQUEsT0FBQSxJQUtBLEtBQUEsWUFBQSxrQkFDQSxLQUFBLFlBQUEsa0JBa0pBIiwic291cmNlc0NvbnRlbnQiOlsiLyoganNoaW50IHN0cmljdDogZmFsc2UgKi9cclxudmFyIGNvbE4gPSA1MSxcclxuICAgIFAgPSAwLjUsXHJcbiAgICBTLFxyXG4gICAgcm93TixcclxuICAgIG9yYW5nZUFycixcclxuICAgIHBsYXllckxDLFxyXG4gICAgZ3JlZW5BcnIsXHJcbiAgICBlbmVteUxDLFxyXG4gICAgYmYxLFxyXG4gICAgYmYyLFxyXG4gICAgbWF4TNChLFxyXG4gICAgVywgSCwgZFcsIGRILCBoYWxmVywgY29sSE4sIG1heEdlbixcclxuICAgIENMUlMgPSBbXCIjNUExRjAwXCIsIFwiI0QxNTcwRFwiLFwiIzQ3NzcyNVwiLCBcInJnYmEoMCwwLDAsMSlcIl0sXHJcbiAgICBhbmltYXRpb24gPSBmYWxzZSxcclxuICAgIGdyaWRPbiA9IHRydWUsXHJcbiAgICBjYWNoZSA9IHtcclxuICAgICAgICBncmVlbnM6IHtcclxuICAgICAgICAgICAgaTogMTAwMCxcclxuICAgICAgICAgICAgajogMTAwMFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgb3Jhbmdlczoge1xyXG4gICAgICAgICAgICBpOiAxMDAwLFxyXG4gICAgICAgICAgICBqOiAxMDAwXHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuICAgIGNoZWNranNvbixcclxuICAgIGNoZWNraW5nLFxyXG4gICAgZ2FtZXN0YXJ0ZWQsXHJcbiAgICBtVGltZW91dCxcclxuICAgIGJvdGh0cmliZXMsXHJcbiAgICBkcmFnZ2luZyxcclxuICAgIGNlbGxudW0sXHJcbiAgICBvcmFuZ2VzLFxyXG4gICAgZ3JlZW5zLFxyXG4gICAgZGVhZCxcclxuICAgIGdlbmVyYXRpb247XHJcblxyXG5mdW5jdGlvbiBnZXRFbChzKSB7IHJldHVybiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHMpOyB9XHJcblxyXG52YXIgZ2FtZSA9IGdldEVsKFwiI2dhbWVcIiksXHJcbiAgICBncmlkID0gZ2V0RWwoXCIjZ3JpZFwiKSxcclxuICAgIHBhbmUgPSBnZXRFbChcIiNwYW5lXCIpLFxyXG4gICAgYXBwbHkgPSBnZXRFbChcIiNhcHBseVwiKSxcclxuICAgIHJ1bGVzQnRuID0gZ2V0RWwoXCIjbmF2LXJ1bGVzXCIpLFxyXG4gICAgb3B0aW9uQnRuID0gZ2V0RWwoXCIjbmF2LW9wdGlvblwiKSxcclxuICAgIG5hdmJ0bnMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFwiYnRuXCIpLFxyXG4gICAgcGFuZWxzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShcInBhbmVsc1wiKSxcclxuICAgIGZvcm0gPSBkb2N1bWVudC5mb3Jtc1swXSxcclxuICAgIGMgPSBnYW1lLmdldENvbnRleHQoXCIyZFwiKSxcclxuICAgIGfRgSA9IGdyaWQuZ2V0Q29udGV4dChcIjJkXCIpLFxyXG4gICAgYiA9IGRvY3VtZW50LmJvZHksXHJcbiAgICB3aW5kb3dXID0gd2luZG93LmlubmVyV2lkdGgsXHJcbiAgICB3aW5kb3dIID0gd2luZG93LmlubmVySGVpZ2h0LFxyXG4gICAgaW5mb3JtZXI7XHJcblxyXG5mdW5jdGlvbiBpbml0KHNob3dwYW5lbCkge1xyXG4gICAgZ2VuZXJhdGlvbiA9IDA7XHJcbiAgICBjZWxsbnVtID0ge307XHJcbiAgICBvcmFuZ2VzID0gMDtcclxuICAgIGdyZWVucyA9IDA7XHJcbiAgICBkZWFkID0gMDtcclxuICAgIGJvdGh0cmliZXMgPSArZm9ybS5ib3RodHJpYmVzLnZhbHVlO1xyXG4gICAgY2hlY2tpbmcgPSArZm9ybS5jaGVja2luZy52YWx1ZTtcclxuICAgIG1heEdlbiA9IGdldEdlbk51bWJlcigrZm9ybS5nZW5udW0udmFsdWUpO1xyXG4gICAgUyA9IE1hdGguZmxvb3Iod2luZG93Vy9jb2xOKTtcclxuICAgIHJvd04gPSBNYXRoLmZsb29yKHdpbmRvd0gvUyk7XHJcbiAgICBXID0gUyAqIGNvbE47XHJcbiAgICBIID0gUyAqIHJvd047XHJcbiAgICBkVyA9ICh3aW5kb3dXIC0gVykvMjtcclxuICAgIGRIID0gKHdpbmRvd0ggLSBIKS8yO1xyXG4gICAgY29sSE4gPShjb2xOIC0gMSkvMjtcclxuICAgIGhhbGZXID0gUyAqIGNvbEhOO1xyXG4gICAgbWF4TNChID0gZ2V0Q2VsbHNOdW1iZXIoUCk7XHJcbiAgICBpbmZvcm1lciA9IG5ldyBJbmZvcm1lcigpO1xyXG5cclxuICAgIGdhbWUud2lkdGggPSBXO1xyXG4gICAgZ2FtZS5oZWlnaHQgPSBIO1xyXG4gICAgZ3JpZC53aWR0aCA9IFc7XHJcbiAgICBncmlkLmhlaWdodCA9IEg7XHJcbiAgICBnYW1lLnN0eWxlLmxlZnQgPSBkVyArIFwicHhcIjtcclxuICAgIGdhbWUuc3R5bGUudG9wID0gZEggKyBcInB4XCI7XHJcbiAgICBncmlkLnN0eWxlLmxlZnQgPSBkVyArIFwicHhcIjtcclxuICAgIGdyaWQuc3R5bGUudG9wID0gZEggKyBcInB4XCI7XHJcblxyXG4gICAgcGFuZS5zdHlsZS50b3AgPSBkSCArIFwicHhcIjtcclxuICAgIHBhbmUuc3R5bGUucmlnaHQgPSBkVyArIFwicHhcIjtcclxuICAgIHBhbmUuc3R5bGUud2lkdGggPSBoYWxmVyArIFwicHhcIjtcclxuICAgIHBhbmUuc3R5bGUuaGVpZ2h0ID0gSCArIFwicHhcIjtcclxuICAgIGZvcm0ubGl2ZS52YWx1ZSA9IG1heEzQoTtcclxuICAgIGZvcm0uZ2VubnVtTy52YWx1ZSA9IG1heEdlbi50b1N0cmluZygpO1xyXG5cclxuICAgIGlmICggYm90aHRyaWJlcyApIHtcclxuICAgICAgICBvcmFuZ2VBcnIgPSBnZXRFbXB0eUFycmF5KGNvbEhOLCByb3dOKTtcclxuICAgICAgICBncmVlbkFyciA9IGdldEVtcHR5QXJyYXkoY29sSE4sIHJvd04pO1xyXG4gICAgICAgIGNlbGxudW0uZ3JlZW5zID0gMDtcclxuICAgICAgICBjZWxsbnVtLm9yYW5nZXMgPSAwO1xyXG4gICAgfWVsc2Uge1xyXG4gICAgICAgIG9yYW5nZUFyciA9IGdldEVtcHR5QXJyYXkoY29sSE4sIHJvd04pO1xyXG4gICAgICAgIGdyZWVuQXJyID0gZ2V0VHJpYmVBcnJheShjb2xITiwgcm93TiwgMik7XHJcbiAgICAgICAgY2VsbG51bSA9IGNoZWNrQ2VsbE51bShncmVlbkFycik7XHJcbiAgICB9XHJcblxyXG4gICAgZHJhd1N0YWdlKG9yYW5nZUFyciwgXCJsZWZ0XCIpO1xyXG5cclxuICAgIGlmICggZ3JpZE9uICkgeyBkcmF3R3JpZChTLCBjb2xOLCByb3dOLCB0cnVlKTsgfVxyXG4gICAgaWYgKCBzaG93cGFuZWwgKSB7IHJlbUNsYXNzKHBhbmUsIFwiaGlkZGVuXCIpOyB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGdldENlbGxzTnVtYmVyKHApIHtcclxuICAgIHJldHVybiBNYXRoLmZsb29yKGNvbEhOICogcm93TiAqIHApO1xyXG59XHJcblxyXG5mdW5jdGlvbiBnZXRHZW5OdW1iZXIobikge1xyXG4gICAgcmV0dXJuICggbiApID8gbiA6IEluZmluaXR5O1xyXG59XHJcblxyXG5mdW5jdGlvbiBJbmZvcm1lcigpIHtcclxuICAgIHZhciBzZWxmID0gdGhpcyxcclxuICAgICAgICBoID0gSC84LFxyXG4gICAgICAgIGZzID0gaC8xLjIsXHJcbiAgICAgICAgcmVjdFkgPSAoSCAtIGgpLzIsXHJcbiAgICAgICAgdGV4dFkgPSByZWN0WSArIGgvMjtcclxuICAgIHNlbGYubXNnT24gPSBmYWxzZTtcclxuICAgIHNlbGYuZHJhd1Njb3JlID0gZnVuY3Rpb24gKGNlbGxzKSB7XHJcbiAgICAgICAgdmFyIG1heCA9IE1hdGgubWF4KGNlbGxzLm9yYW5nZXMsIGNlbGxzLmdyZWVucyksXHJcbiAgICAgICAgICAgIHRleHQgPSBtYXggKyBcIjpcIiArIG1heCxcclxuICAgICAgICAgICAgbnYsIG54LCB0ZXh0WDEsIHRleHRYMiwgdGV4dFgzO1xyXG4gICAgICAgIGfRgS5zYXZlKCk7XHJcbiAgICAgICAgZ9GBLmZvbnQgPSBmcyArIFwicHggZmFudGFzeVwiO1xyXG4gICAgICAgIG53ID0gZ9GBLm1lYXN1cmVUZXh0KHRleHQpLndpZHRoICsgaDtcclxuICAgICAgICBueCA9IChXIC0gbncpLzI7XHJcbiAgICAgICAgdGV4dFgyID0gbnggKyBudy8yLFxyXG4gICAgICAgIHRleHRYMSA9IHRleHRYMiAtIGgvNCxcclxuICAgICAgICB0ZXh0WDMgPSB0ZXh0WDIgKyBoLzQ7XHJcbiAgICAgICAgZ9GBLnRleHRCYXNlbGluZSA9IFwibWlkZGxlXCI7XHJcbiAgICAgICAgZ9GBLmZpbGxTdHlsZSA9IFwiIzVBMUYwMFwiO1xyXG4gICAgICAgIGfRgS5saW5lV2lkdGggPSA1O1xyXG4gICAgICAgIGfRgS5zdHJva2VTdHlsZSA9IFwiI0ZERTc5MlwiO1xyXG4gICAgICAgIGfRgS5maWxsUmVjdChueCwgcmVjdFksIG53LCBoKTtcclxuICAgICAgICBn0YEuc3Ryb2tlUmVjdChueCwgcmVjdFksIG53LCBoKTtcclxuICAgICAgICBn0YEuZmlsbFN0eWxlID0gXCIjRDE1NzBEXCI7XHJcbiAgICAgICAgZ9GBLnRleHRBbGlnbiA9IFwiZW5kXCI7XHJcbiAgICAgICAgZ9GBLmZpbGxUZXh0KGNlbGxzLm9yYW5nZXMsIHRleHRYMSwgdGV4dFkpO1xyXG4gICAgICAgIGfRgS50ZXh0QWxpZ24gPSBcInN0YXJ0XCI7XHJcbiAgICAgICAgZ9GBLmZpbGxTdHlsZSA9IFwiIzQ3NzcyNVwiO1xyXG4gICAgICAgIGfRgS5maWxsVGV4dChjZWxscy5ncmVlbnMsIHRleHRYMywgdGV4dFkpO1xyXG4gICAgICAgIGfRgS50ZXh0QWxpZ24gPSBcImNlbnRlclwiO1xyXG4gICAgICAgIGfRgS5maWxsU3R5bGUgPSBcIiNGREU3OTJcIjtcclxuICAgICAgICBn0YEuZmlsbFRleHQoXCI6XCIsIHRleHRYMiwgdGV4dFkpO1xyXG4gICAgICAgIGfRgS5mb250ID0gZnMvMiArIFwicHggc2Fucy1zZXJpZlwiO1xyXG4gICAgICAgIGfRgS5maWxsVGV4dChcIkdcIiArIGdlbmVyYXRpb24sIHRleHRYMiwgdGV4dFkgKyBmcyk7XHJcblxyXG4gICAgICAgIGfRgS5yZXN0b3JlKCk7XHJcbiAgICB9O1xyXG4gICAgc2VsZi5kcmF3TWVzc2FnZSA9IGZ1bmN0aW9uIChtKSB7XHJcbiAgICAgICAgc2VsZi5tc2dPbiA9IHRydWU7XHJcbiAgICAgICAgZ9GBLnNhdmUoKTtcclxuICAgICAgICBn0YEuZm9udCA9IGZzLzIgKyBcInB4IHNhbnMtc2VyaWZcIjtcclxuICAgICAgICB2YXIgbncgPSBn0YEubWVhc3VyZVRleHQobSkud2lkdGgsXHJcbiAgICAgICAgICAgIG54ID0gKFcgLSBudykvMjtcclxuICAgICAgICBn0YEudGV4dEJhc2VsaW5lID0gXCJtaWRkbGVcIjtcclxuICAgICAgICBn0YEuZmlsbFN0eWxlID0gXCIjNUExRjAwXCI7XHJcbiAgICAgICAgZ9GBLmxpbmVXaWR0aCA9IDU7XHJcbiAgICAgICAgZ9GBLnN0cm9rZVN0eWxlID0gXCIjRkRFNzkyXCI7XHJcbiAgICAgICAgZ9GBLmZpbGxSZWN0KG54LCByZWN0WSwgbncgKyBoLzIsIGgpO1xyXG4gICAgICAgIGfRgS5zdHJva2VSZWN0KG54LCByZWN0WSwgbncgKyBoLzIsIGgpO1xyXG4gICAgICAgIGfRgS5maWxsU3R5bGUgPSBcIiNGREU3OTJcIjtcclxuICAgICAgICBn0YEudGV4dEFsaWduID0gXCJzdGFydFwiO1xyXG4gICAgICAgIGfRgS5maWxsVGV4dChtLCBueCArIGgvNCwgdGV4dFkpO1xyXG4gICAgICAgIGfRgS5yZXN0b3JlKCk7XHJcbiAgICB9O1xyXG59XHJcblxyXG5mdW5jdGlvbiBnZXRFbXB0eUFycmF5KGNvbCwgcm93KSB7XHJcbiAgICB2YXIgYXJyID0gW10sIGkgPSAwLCBqO1xyXG4gICAgZm9yICggOyBpIDwgY29sOyBpKysgKSB7XHJcbiAgICAgICAgYXJyW2ldID0gbmV3IEFycmF5KHJvdyk7XHJcbiAgICAgICAgZm9yICggaiA9IDA7IGogPCByb3c7ICkgeyBhcnJbaV1baisrXSA9IDA7IH1cclxuICAgIH1cclxuICAgIHJldHVybiBhcnI7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGdldFRyaWJlQXJyYXkoY29sLCByb3csIGNmaWxsKSB7XHJcbiAgICB2YXIgaW5pdGFyciA9IGdldEluaXRBcnJheShjb2wsIHJvdywgY2ZpbGwpLFxyXG4gICAgICAgIGFyciA9IFtdLFxyXG4gICAgICAgIGNvbGFycjtcclxuICAgIHdoaWxlICggaW5pdGFyci5sZW5ndGggKSB7XHJcbiAgICAgICAgY29sYXJyID0gaW5pdGFyci5zcGxpY2UoMCwgcm93KTtcclxuICAgICAgICBhcnIucHVzaChjb2xhcnIpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGFycjtcclxufVxyXG5cclxuZnVuY3Rpb24gZ2V0SW5pdEFycmF5KGNvbCwgcm93LCBjZmlsbCkge1xyXG4gICAgdmFyIGVtcHR5ID0gKGNvbCAqIHJvdykgLSBtYXhM0KEsXHJcbiAgICAgICAgZmlsbGVkID0gbmV3IEFycmF5KG1heEzQoSksXHJcbiAgICAgICAgemVyb3MgPSBuZXcgQXJyYXkoZW1wdHkpLFxyXG4gICAgICAgIGFyciwgaTtcclxuICAgIGZvciAoIGkgPSAwOyBpIDwgbWF4TNChOyApIHsgZmlsbGVkW2krK10gPSBjZmlsbDsgfVxyXG4gICAgZm9yICggaSA9IDA7IGkgPCBlbXB0eTsgKSB7IHplcm9zW2krK10gPSAwOyB9XHJcbiAgICBhcnIgPSBmaWxsZWQuY29uY2F0KHplcm9zKTtcclxuICAgIHJldHVybiBzaHVmZmxlKGFycik7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGpvaW5BcnJheXMoYSwgYikge1xyXG4gICAgdmFyIGxlbiA9IGFbMF0ubGVuZ3RoLFxyXG4gICAgICAgIG1pZCA9IG5ldyBBcnJheShsZW4pLFxyXG4gICAgICAgIGogPSAwO1xyXG4gICAgZm9yICggOyBqIDwgbGVuOyApIHsgbWlkW2orK10gPSAwOyB9XHJcbiAgICByZXR1cm4gYS5jb25jYXQoW21pZF0sIGIpO1xyXG59XHJcblxyXG4vLyBUaGUgRmlzaGVyLVlhdGVzIChLbnV0aCkgc2h1ZmZsZSBhbGdvcml0aG1cclxuZnVuY3Rpb24gc2h1ZmZsZShhcnIpIHtcclxuICAgIHZhciBpID0gYXJyLmxlbmd0aCwgcmFuZGk7XHJcbiAgICB3aGlsZSAoIGkgKSB7XHJcbiAgICAgICAgcmFuZGkgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoaS0tKSk7XHJcbiAgICAgICAgYXJyW2ldID0gW2FycltyYW5kaV0sIGFycltyYW5kaV0gPSBhcnJbaV1dWzBdO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGFycjtcclxufVxyXG5cclxuIiwiLyoganNoaW50IHN0cmljdDogZmFsc2UgKi9cclxuXHJcbmZ1bmN0aW9uIGdhbWVJbml0KCkge1xyXG4gICAgYWRkQ2xhc3MocGFuZSwgXCJoaWRkZW5cIik7XHJcbiAgICBpZiAoIGdyaWRPbiApIHsgZHJhd0dyaWQoUywgY29sTiwgcm93TiwgXCJib3RoXCIpOyB9XHJcbiAgICBkcmF3U3RhZ2UoZ3JlZW5BcnIsIFwicmlnaHRcIik7XHJcbiAgICBkcmF3U3RhZ2Uob3JhbmdlQXJyLCBcImxlZnRcIik7XHJcbiAgICBpbmZvcm1lci5kcmF3TWVzc2FnZShcIkhpdCB0aGUgc3BhY2ViYXIgb3IgYW55IGFycm93ZXMgd2hlbiB5b3UncmUgZG9uZS5cIik7XHJcbiAgICBnYW1lc3RhcnRlZCA9IHRydWU7XHJcbiAgICBtVGltZW91dCA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGluZm9ybWVyLm1zZ09uID0gZmFsc2U7XHJcbiAgICAgICAgaWYgKCBncmlkT24gKSB7XHJcbiAgICAgICAgICAgIGlmICggZ3JpZE9uICkgeyBkcmF3R3JpZChTLCBjb2xOLCByb3dOLCBcImJvdGhcIik7IH1cclxuICAgICAgICB9ZWxzZSB7XHJcbiAgICAgICAgICAgIGfRgS5jbGVhclJlY3QoMCwgMCwgVywgSCk7XHJcbiAgICAgICAgfVxyXG4gICAgfSwgMTAwMCk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHN0YXJ0R2FtZShhbmltKSB7XHJcbiAgICBiZjEgPSBnZXRFbXB0eUFycmF5KGNvbE4sIHJvd04pO1xyXG4gICAgYmYyID0gam9pbkFycmF5cyhvcmFuZ2VBcnIsIGdyZWVuQXJyKTtcclxuICAgIGlmICggZ3JpZE9uICkgeyBkcmF3R3JpZChTLCBjb2xOLCByb3dOICk7IH1cclxuICAgIGRyYXdTdGFnZShiZjIpO1xyXG4gICAgbVRpbWVvdXQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhhbmltKTtcclxuICAgICAgICBzaG93TXVzdEdvT24oYW5pbSk7XHJcbiAgICB9LCAxMDAwKTtcclxufVxyXG5cclxuZnVuY3Rpb24gZHJhd1N0YWdlKGFyciwgaGFsZikge1xyXG4gICAgdmFyIGxlbiA9IGFyci5sZW5ndGgsXHJcbiAgICAgICAgaSA9IDAsIGosIGFkZCA9IDA7XHJcbiAgICBpZiAoIGhhbGYgPT09IFwicmlnaHRcIiApIHtcclxuICAgICAgICBhZGQgPSBoYWxmVyArIFM7XHJcbiAgICB9XHJcbiAgICBmb3IgKCA7IGkgPCBsZW47IGkrKyApIHtcclxuICAgICAgICBmb3IgKCBqID0gMDsgaiA8IHJvd047IGorKyApIHtcclxuICAgICAgICAgICAgZHJhd0NlbGwoYWRkICsgaSpTLCBqKlMsIGFycltpXVtqXSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBkcmF3R3JpZChzLCBudywgbmgsIGhhbGYpIHtcclxuICAgIHZhciB3ID0gKCBoYWxmICkgPyBoYWxmVyA6IFcsXHJcbiAgICAgICAgbndoID0gKCBoYWxmICkgPyBjb2xITiArIDEgOiBudyArIDEsXHJcbiAgICAgICAgbSwgYWRkLCBpID0gMDtcclxuICAgIGfRgS5zdHJva2VTdHlsZSA9IENMUlNbM107XHJcbiAgICBn0YEuY2xlYXJSZWN0KDAsIDAsIFcsIEgpO1xyXG4gICAgZm9yICggOyBpIDwgbndoOyBpKysgKSB7XHJcbiAgICAgICAgbSA9IGkgKiBzO1xyXG4gICAgICAgIGRyYXdMaW5lKG0sIDAsIG0sIEgpO1xyXG4gICAgfVxyXG4gICAgZm9yICggaSA9IDA7IGkgPCBuaCArIDE7IGkrKyApIHtcclxuICAgICAgICBtID0gaSAqIHM7XHJcbiAgICAgICAgZHJhd0xpbmUoMCwgbSwgdywgbSk7XHJcbiAgICB9XHJcbiAgICBpZiAoIGhhbGYgPT09IFwiYm90aFwiICkge1xyXG4gICAgICAgIGFkZCA9IGhhbGZXICsgUztcclxuICAgICAgICBmb3IgKCBpID0gMDsgaSA8IG53aDsgaSsrICkge1xyXG4gICAgICAgICAgICBtID0gYWRkICsgaSAqIHM7XHJcbiAgICAgICAgICAgIGRyYXdMaW5lKG0sIDAsIG0sIEgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmb3IgKCBpID0gMDsgaSA8IG5oICsgMTsgaSsrICkge1xyXG4gICAgICAgICAgICBtID0gaSAqIHM7XHJcbiAgICAgICAgICAgIGRyYXdMaW5lKGFkZCwgbSwgYWRkICsgdywgbSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBkcmF3TGluZShzeCwgc3ksIGZ4LCBmeSkge1xyXG4gICAgZ9GBLmJlZ2luUGF0aCgpO1xyXG4gICAgZ9GBLm1vdmVUbyhzeCwgc3kpO1xyXG4gICAgZ9GBLmxpbmVUbyhmeCwgZnkpO1xyXG4gICAgZ9GBLnN0cm9rZSgpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBkcmF3Q2VsbCh4LCB5LCB0KSB7XHJcbiAgICBjLmZpbGxTdHlsZSA9IENMUlNbdF07XHJcbiAgICBjLmZpbGxSZWN0KHgsIHksIFMsIFMpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBzaG93TXVzdEdvT24oYW5pbSkge1xyXG4gICAgaWYgKCBpbmZvcm1lci5tc2dPbiApIHtcclxuICAgICAgICBjbGVhclRpbWVvdXQobVRpbWVvdXQpO1xyXG4gICAgICAgIGluZm9ybWVyLm1zZ09uID0gZmFsc2U7XHJcbiAgICAgICAgaWYgKCBncmlkT24gKSB7XHJcbiAgICAgICAgICAgIGRyYXdHcmlkKFMsIGNvbE4sIHJvd04gKTtcclxuICAgICAgICB9ZWxzZSB7XHJcbiAgICAgICAgICAgIGfRgS5jbGVhclJlY3QoMCwgMCwgVywgSCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYgKCAhYW5pbSApIHtcclxuICAgICAgICBuZXh0R2VuKCk7XHJcbiAgICB9ZWxzZSB7XHJcbiAgICAgICAgYW5pbWF0aW9uID0gIWFuaW1hdGlvbjtcclxuICAgICAgICBpZiAoIGFuaW1hdGlvbiApIHsgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKG5leHRHZW4pOyB9XHJcbiAgICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIG5leHRHZW4oKSB7XHJcbiAgICB2YXIgaSA9IDAsIGo7XHJcbiAgICBmb3IgKCA7IGkgPCBjb2xOOyBpKysgKSB7XHJcbiAgICAgICAgZm9yICggaiA9IDA7IGogPCByb3dOOyBqKysgKSB7XHJcbiAgICAgICAgICAgIGJmMVtpXVtqXSA9IGNhbGNTdGF0ZShpLCBqKTtcclxuICAgICAgICAgICAgZHJhd0NlbGwoaSpTLCBqKlMsIGJmMVtpXVtqXSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgYmYxID0gW2JmMiwgYmYyID0gYmYxXVswXTsgICAvLyBzd2FwIHRoZSBhcnJheXNcclxuICAgIGdlbmVyYXRpb24rKztcclxuXHJcbiAgICBpZiAoIGFuaW1hdGlvbiApIHtcclxuICAgICAgICBpZiAoIGNoZWNraW5nICkge1xyXG4gICAgICAgICAgICBpZiAoIGJmMi5jaGVjayApIHtcclxuICAgICAgICAgICAgICAgIGFuaW1hdGlvbiA9IGNoZWNranNvbiAhPT0gSlNPTi5zdHJpbmdpZnkoYmYyKTtcclxuICAgICAgICAgICAgICAgIGJmMi5jaGVjayA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICggZ2VuZXJhdGlvbiUyNSA9PT0gMCApIHtcclxuICAgICAgICAgICAgICAgIGFuaW1hdGlvbiA9IGNoZWNrQ2VsbE51bShiZjIsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgYmYyLmNoZWNrID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIGNoZWNranNvbiA9IEpTT04uc3RyaW5naWZ5KGJmMik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKCAhYW5pbWF0aW9uICkgeyBkaXNwbGF5UmVzdWx0cygpOyB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICggZ2VuZXJhdGlvbiA+PSBtYXhHZW4gKSB7XHJcbiAgICAgICAgICAgIGFuaW1hdGlvbiA9ICFhbmltYXRpb247XHJcbiAgICAgICAgICAgIGRpc3BsYXlSZXN1bHRzKCk7XHJcbiAgICAgICAgfWVsc2Uge1xyXG4gICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUobmV4dEdlbik7XHJcbiAgICAgICAgfVxyXG4gICAgfWVsc2Uge1xyXG4gICAgICAgIGlmICggZ2VuZXJhdGlvbiA+PSBtYXhHZW4gKSB7XHJcbiAgICAgICAgICAgIGRpc3BsYXlSZXN1bHRzKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBjaGVja1N0YXRlKCkge1xyXG4gICAgY2VsbG51bSA9IGNoZWNrQ2VsbE51bShiZjIpO1xyXG4gICAgaW5mb3JtZXIuZHJhd1Njb3JlKGNlbGxudW0pO1xyXG59XHJcblxyXG5mdW5jdGlvbiBkaXNwbGF5UmVzdWx0cygpIHtcclxuICAgIGdhbWVzdGFydGVkID0gZmFsc2U7XHJcbiAgICBjZWxsbnVtID0gY2hlY2tDZWxsTnVtKGJmMik7XHJcbiAgICBpbmZvcm1lci5kcmF3U2NvcmUoY2VsbG51bSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNoZWNrQ2VsbE51bShhcnIsIGNoZWNrKSB7XHJcbiAgICB2YXIgbGVuID0gYXJyLmxlbmd0aCxcclxuICAgICAgICBpID0gMCwgaixcclxuICAgICAgICBvYmogPSB7XHJcbiAgICAgICAgICAgIGRlYWQ6IDAsXHJcbiAgICAgICAgICAgIG9yYW5nZXM6IDAsXHJcbiAgICAgICAgICAgIGdyZWVuczogMFxyXG4gICAgICAgIH07XHJcbiAgICBmb3IgKCA7IGkgPCBsZW47IGkrKyApIHtcclxuICAgICAgICBmb3IgKCBqID0gMDsgaiA8IHJvd047IGorKyApIHtcclxuICAgICAgICAgICAgaWYgKCBhcnJbaV1bal0gKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIGFycltpXVtqXSA9PT0gMSApIHtcclxuICAgICAgICAgICAgICAgICAgICBvYmoub3JhbmdlcysrO1xyXG4gICAgICAgICAgICAgICAgfWVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIG9iai5ncmVlbnMrKztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfWVsc2Uge1xyXG4gICAgICAgICAgICAgICAgb2JqLmRlYWQrKztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBpZiAoIGNoZWNrICkge1xyXG4gICAgICAgIHJldHVybiAhIW9iai5vcmFuZ2VzICYmICEhb2JqLmdyZWVucztcclxuICAgIH1cclxuICAgIHJldHVybiBvYmo7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNhbGNTdGF0ZShpLGopIHtcclxuXHJcbiAgICAvLyBUaGUgYmF0dGxlZmllbGQgZXNzZW50aWFsbHkgaXMgYSB0b3J1cy5cclxuICAgIHZhciBtaSA9ICggaS0xIDwgMCApID8gY29sTi0xIDogaS0xLFxyXG4gICAgICAgIHBpID0gKCBpKzEgPiBjb2xOLTEgKSA/IDAgOiBpKzEsXHJcbiAgICAgICAgbWogPSAoIGotMSA8IDAgKSA/IHJvd04tMSA6IGotMSxcclxuICAgICAgICBwaiA9ICggaisxID4gcm93Ti0xICkgPyAwIDogaisxLFxyXG4gICAgLy8gYWxsIHRoZSBuZWlnaGJvdXJzIGFyZSB3ZWxjb21lIHRvIHRoZSBzcGVjaWFsIGFycmF5XHJcbiAgICAgICAgbmVpZ2hib3VycyA9IFtcclxuICAgICAgICAgICAgYmYyW21pXVttal0sXHJcbiAgICAgICAgICAgIGJmMlttaV1bal0sXHJcbiAgICAgICAgICAgIGJmMlttaV1bcGpdLFxyXG4gICAgICAgICAgICBiZjJbaV1bbWpdLFxyXG4gICAgICAgICAgICBiZjJbaV1bcGpdLFxyXG4gICAgICAgICAgICBiZjJbcGldW21qXSxcclxuICAgICAgICAgICAgYmYyW3BpXVtqXSxcclxuICAgICAgICAgICAgYmYyW3BpXVtwal1cclxuICAgICAgICBdLFxyXG4gICAgICAgIHplcnJvID0gMCwgb25lcyA9IDAsIHR3b3MgPSAwLCB6ID0gMCwgYWxpdmU7XHJcbiAgICBmb3IgKCA7IHo8ODsgeisrICkge1xyXG4gICAgICAgIGlmICggbmVpZ2hib3Vyc1t6XSApIHtcclxuICAgICAgICAgICAgaWYgKCBuZWlnaGJvdXJzW3pdPT09MSApIHtcclxuICAgICAgICAgICAgICAgIG9uZXMrKztcclxuICAgICAgICAgICAgfWVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdHdvcysrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfWVsc2Uge1xyXG4gICAgICAgICAgICB6ZXJybysrO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGFsaXZlID0gb25lcyArIHR3b3M7XHJcbiAgICAvLyB1c3VhbCBydWxlcyBvZiB0aGUgQ29ud2F5J3MgR2FtZSBPZiBMaWZlXHJcblxyXG4gICAgaWYgKCBiZjJbaV1bal0gKSB7XHJcbiAgICAgICAgcmV0dXJuICggYWxpdmU8MiB8fCBhbGl2ZT4zICkgPyAwIDogYmYyW2ldW2pdO1xyXG4gICAgfVxyXG4gICAgLy9idXQgaWYgdGhlIGRlYWQgY2VsbCB3YXMgbWFkZSB0byBjYW1lIHRvIGxpZmUsIGl0IGFwcGVhcnMgYXMgYSBtZW1iZXIgb2YgdGhlIHByZWRvbWluYW50IChpbiB0aGUgbmVpZ2hib3VyaG9vZCkgdHJpYmVcclxuICAgIHJldHVybiAoIGFsaXZlIT09MyApID8gMCA6ICggdHdvcyA+IG9uZXMgKSA/IDIgOiAoIG9uZXMgPiB0d29zICkgPyAxIDogKE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSswLjUpKTtcclxufSIsIi8qIGpzaGludCBzdHJpY3Q6IGZhbHNlICovXHJcblxyXG5iLm9ua2V5dXAgPSBmdW5jdGlvbihlKSB7XHJcbiAgICBzd2l0Y2ggKGUua2V5Q29kZSkge1xyXG4gICAgICAgIGNhc2UgMzI6IG9uU3BhY2VCYXJQcmVzcygpOyBicmVhaztcclxuICAgICAgICBjYXNlIDI3OiBpZiAoICFhbmltYXRpb24gKSB7IGluaXQodHJ1ZSk7IH0gYnJlYWs7XHJcbiAgICAgICAgY2FzZSAzOTogb25BcnJvd1ByZXNzKCk7IGJyZWFrO1xyXG4gICAgICAgIGNhc2UgMzc6IG9uQXJyb3dQcmVzcygpOyBicmVhaztcclxuICAgICAgICBjYXNlIDM4OiBvbkFycm93UHJlc3MoKTsgYnJlYWs7XHJcbiAgICAgICAgY2FzZSA0MDogb25BcnJvd1ByZXNzKCk7IGJyZWFrO1xyXG4gICAgfVxyXG59O1xyXG5cclxuZnVuY3Rpb24gb25BcnJvd1ByZXNzKCkge1xyXG4gICAgaWYgKCBnYW1lc3RhcnRlZCAmJiAhYW5pbWF0aW9uICYmIGdlbmVyYXRpb24gPCBtYXhHZW4gKSB7XHJcbiAgICAgICAgaWYgKCAhZ2VuZXJhdGlvbiApIHtcclxuICAgICAgICAgICAgc3RhcnRHYW1lKCk7XHJcbiAgICAgICAgfWVsc2Uge1xyXG4gICAgICAgICAgICBuZXh0R2VuKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBvblNwYWNlQmFyUHJlc3MoKSB7XHJcbiAgICBpZiAoIGdhbWVzdGFydGVkICYmIGdlbmVyYXRpb24gPCBtYXhHZW4gKSB7XHJcbiAgICAgICAgaWYgKCAhZ2VuZXJhdGlvbiApIHtcclxuICAgICAgICAgICAgc3RhcnRHYW1lKHRydWUpO1xyXG4gICAgICAgIH1lbHNlIHtcclxuICAgICAgICAgICAgc2hvd011c3RHb09uKHRydWUpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5cclxuYi5vbm1vdXNldXAgPSBmdW5jdGlvbihlKSB7XHJcbiAgICBpZiAoIGUudGFyZ2V0Lm5vZGVOYW1lID09PSBcIlNQQU5cIiApIHtcclxuICAgICAgICBvblNwYW5Nb3VzZVVwKGUpO1xyXG4gICAgfWVsc2UgaWYgKCBlLnRhcmdldC5ub2RlTmFtZSA9PT0gXCJDQU5WQVNcIiApIHtcclxuICAgICAgICBvbkNhbnZhc01vdXNlVXAoZSk7XHJcbiAgICB9ZWxzZSBpZiAoIGUudGFyZ2V0Lm5vZGVOYW1lID09PSBcIkRJVlwiICkge1xyXG4gICAgICAgIHN3aXRjaCAoIGUudGFyZ2V0LmlkICkge1xyXG4gICAgICAgICAgICBjYXNlIFwiYXBwbHlcIjogIGFwcGx5Q29uZmlnKCk7IGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIFwic3RhcnRcIjogIGdhbWVJbml0KCk7IGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIFwiZ2VuZXJhdGVcIjogZ2VuZXJhdGVBcnIoKTsgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgXCJyZXNldFwiOiByZXNldEFycigpOyBicmVhaztcclxuICAgICAgICAgICAgZGVmYXVsdDogcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufTtcclxuXHJcbmdyaWQub25tb3VzZWRvd24gPSBvbkNhbnZhc01vdXNlRG93bjtcclxuZ3JpZC5vbm1vdXNlbW92ZSA9IG9uQ2FudmFzTW91c2VNb3ZlO1xyXG5cclxuZnVuY3Rpb24gZ2VuZXJhdGVBcnIoKSB7XHJcbiAgICBpZiAoIGJvdGh0cmliZXMgKSB7XHJcbiAgICAgICAgb3JhbmdlQXJyID0gZ2V0VHJpYmVBcnJheShjb2xITiwgcm93TiwgMSk7XHJcbiAgICAgICAgZ3JlZW5BcnIgPSBnZXRUcmliZUFycmF5KGNvbEhOLCByb3dOLCAyKTtcclxuICAgICAgICBjZWxsbnVtID0gY2hlY2tDZWxsTnVtKGdyZWVuQXJyKTtcclxuICAgICAgICBkcmF3U3RhZ2UoZ3JlZW5BcnIsIFwicmlnaHRcIik7XHJcbiAgICAgICAgZHJhd1N0YWdlKG9yYW5nZUFyciwgXCJsZWZ0XCIpO1xyXG4gICAgICAgIGlmICggZ3JpZE9uICkgeyBkcmF3R3JpZChTLCBjb2xOLCByb3dOLCBcImJvdGhcIik7IH1cclxuICAgIH1lbHNlIHtcclxuICAgICAgICBvcmFuZ2VBcnIgPSBnZXRUcmliZUFycmF5KGNvbEhOLCByb3dOLCAxKTtcclxuICAgICAgICBkcmF3U3RhZ2Uob3JhbmdlQXJyLCBcImxlZnRcIik7XHJcbiAgICAgICAgY2VsbG51bS5vcmFuZ2VzID0gY2hlY2tDZWxsTnVtKG9yYW5nZUFycikub3JhbmdlcztcclxuICAgICAgICBpZiAoIGdyaWRPbiApIHsgZHJhd0dyaWQoUywgY29sTiwgcm93TiwgXCJsZWZ0XCIpOyB9XHJcbiAgICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHJlc2V0QXJyKCkge1xyXG4gICAgaWYgKCBib3RodHJpYmVzICkge1xyXG4gICAgICAgIG9yYW5nZUFyciA9IGdldEVtcHR5QXJyYXkoY29sSE4sIHJvd04pO1xyXG4gICAgICAgIGdyZWVuQXJyID0gZ2V0RW1wdHlBcnJheShjb2xITiwgcm93Tik7XHJcbiAgICAgICAgY2VsbG51bS5ncmVlbnMgPSAwO1xyXG4gICAgICAgIGNlbGxudW0ub3JhbmdlcyA9IDA7XHJcbiAgICAgICAgZHJhd1N0YWdlKGdyZWVuQXJyLCBcInJpZ2h0XCIpO1xyXG4gICAgICAgIGRyYXdTdGFnZShvcmFuZ2VBcnIsIFwibGVmdFwiKTtcclxuICAgICAgICBpZiAoIGdyaWRPbiApIHsgZHJhd0dyaWQoUywgY29sTiwgcm93TiwgXCJib3RoXCIpOyB9XHJcbiAgICB9ZWxzZSB7XHJcbiAgICAgICAgb3JhbmdlQXJyID0gZ2V0RW1wdHlBcnJheShjb2xITiwgcm93Tik7XHJcbiAgICAgICAgZHJhd1N0YWdlKG9yYW5nZUFyciwgdHJ1ZSk7XHJcbiAgICAgICAgaWYgKCBncmlkT24gKSB7IGRyYXdHcmlkKFMsIGNvbE4sIHJvd04sIFwibGVmdFwiKTsgfVxyXG4gICAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBhcHBseUNvbmZpZyhlKSB7XHJcbiAgICB2YXIgcHMgPSBmb3JtLmdldEVsZW1lbnRzQnlUYWdOYW1lKFwicFwiKSxcclxuICAgICAgICBpID0gMDtcclxuICAgIGZvciAoIDsgaSA8IHBzLmxlbmd0aDsgaSsrICkgeyBwc1tpXS5zdHlsZS5vcGFjaXR5ID0gMTsgfVxyXG4gICAgY29sTiA9ICtmb3JtLmNvbG51bS52YWx1ZTtcclxuICAgIFAgPSArZm9ybS5wb3BkZW5zLnZhbHVlO1xyXG4gICAgbWF4R2VuID0gK2Zvcm0uZ2VubnVtLnZhbHVlO1xyXG4gICAgZ3JpZE9uID0gK2Zvcm0uc2hvd2dyaWQudmFsdWU7XHJcbiAgICBpbml0KCk7XHJcblxyXG59XHJcblxyXG5mdW5jdGlvbiBvblNwYW5Nb3VzZVVwKGUpIHtcclxuICAgIHZhciBwYW5lbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGUudGFyZ2V0LmlkLnJlcGxhY2UoXCJuYXZcIiwgXCJwYW5lXCIpKSxcclxuICAgICAgICBpID0gMDtcclxuICAgIGlmICggaGFzQ2xhc3MoZS50YXJnZXQsIFwiaW5hY3RpdmUtYnRuXCIpICkge1xyXG4gICAgICAgIGZvciAoIDsgaSA8IG5hdmJ0bnMubGVuZ3RoOyBpKysgKSB7XHJcbiAgICAgICAgICAgIGFkZENsYXNzKG5hdmJ0bnNbaV0sIFwiaW5hY3RpdmUtYnRuXCIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZW1DbGFzcyhlLnRhcmdldCwgXCJpbmFjdGl2ZS1idG5cIik7XHJcbiAgICAgICAgZm9yICggaSA9IDA7IGkgPCBwYW5lbHMubGVuZ3RoOyBpKysgKSB7XHJcbiAgICAgICAgICAgIGFkZENsYXNzKHBhbmVsc1tpXSwgXCJoaWRkZW5cIik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJlbUNsYXNzKHBhbmVsLCBcImhpZGRlblwiKTtcclxuICAgIH1cclxufVxyXG5cclxuZnVuY3Rpb24gb25DYW52YXNNb3VzZVVwKGUpIHtcclxuICAgIGRyYWdnaW5nID0gZmFsc2U7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIG9uQ2FudmFzTW91c2VEb3duKGUpIHtcclxuICAgIGRyYWdnaW5nID0gdHJ1ZTtcclxuICAgIG9uQ2FudmFzTW91c2VNb3ZlKGUpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBvbkNhbnZhc01vdXNlTW92ZShlKSB7XHJcbiAgICBpZiAoIGRyYWdnaW5nICYmICFnZW5lcmF0aW9uICkge1xyXG4gICAgICAgIHZhciBtb3VzZSA9IGdldFBvaW50ZXJQb3MoZS50YXJnZXQsIGUpLFxyXG4gICAgICAgICAgICBpID0gTWF0aC5mbG9vcihtb3VzZS54L1MpLFxyXG4gICAgICAgICAgICBqID0gTWF0aC5mbG9vcihtb3VzZS55L1MpO1xyXG4gICAgICAgIGlmICggbW91c2UueCA8IGhhbGZXICkge1xyXG4gICAgICAgICAgICBpZiAoICEoY2FjaGUub3Jhbmdlcy5pID09PSBpICYmIGNhY2hlLm9yYW5nZXMuaiA9PT0gaikgKSB7XHJcbiAgICAgICAgICAgICAgICBvcmFuZ2VBcnJbaV1bal0gPSAoIG9yYW5nZUFycltpXVtqXSApID8gMCA6IDE7XHJcbiAgICAgICAgICAgICAgICBpZiAoIG9yYW5nZUFycltpXVtqXSApIHtcclxuICAgICAgICAgICAgICAgICAgICBjZWxsbnVtLm9yYW5nZXMrKztcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIGNlbGxudW0ub3JhbmdlcyA+IG1heEzQoSApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2VsbG51bS5vcmFuZ2VzLS07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9yYW5nZUFycltpXVtqXSA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfWVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGNlbGxudW0ub3Jhbmdlcy0tO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgY2FjaGUub3Jhbmdlcy5pID0gaTtcclxuICAgICAgICAgICAgICAgIGNhY2hlLm9yYW5nZXMuaiA9IGo7XHJcbiAgICAgICAgICAgICAgICBkcmF3U3RhZ2Uob3JhbmdlQXJyLCBcImxlZnRcIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9ZWxzZSBpZiAoIGJvdGh0cmliZXMgJiYgbW91c2UueCA+IGhhbGZXICsgUyApIHtcclxuICAgICAgICAgICAgaSAtPSBjb2xITiArIDE7XHJcbiAgICAgICAgICAgIGlmICggIShjYWNoZS5ncmVlbnMuaSA9PT0gaSAmJiBjYWNoZS5ncmVlbnMuaiA9PT0gaikgKSB7XHJcbiAgICAgICAgICAgICAgICBncmVlbkFycltpXVtqXSA9ICggZ3JlZW5BcnJbaV1bal0gKSA/IDAgOiAyO1xyXG4gICAgICAgICAgICAgICAgaWYgKCBncmVlbkFycltpXVtqXSApIHtcclxuICAgICAgICAgICAgICAgICAgICBjZWxsbnVtLmdyZWVucysrO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICggY2VsbG51bS5ncmVlbnMgPiBtYXhM0KEgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNlbGxudW0uZ3JlZW5zLS07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGdyZWVuQXJyW2ldW2pdID0gMDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9ZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2VsbG51bS5ncmVlbnMtLTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGNhY2hlLmdyZWVucy5pID0gaTtcclxuICAgICAgICAgICAgICAgIGNhY2hlLmdyZWVucy5qID0gajtcclxuICAgICAgICAgICAgICAgIGRyYXdTdGFnZShncmVlbkFyciwgXCJyaWdodFwiKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5cclxuZnVuY3Rpb24gZ2V0Q2VsbENvb3JkKG1vdXNlKSB7XHJcbiAgICB2YXIgaSA9IE1hdGgucm91bmQobW91c2UueC9TKSxcclxuICAgICAgICBqID0gTWF0aC5yb3VuZChtb3VzZS55L1MpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBoYXNDbGFzcyhlbCwgY2xzKSB7XHJcbiAgICByZXR1cm4gKFwiIFwiICsgZWwuY2xhc3NOYW1lICsgXCIgXCIpLmluZGV4T2YoXCIgXCIgKyBjbHMgKyBcIiBcIikgPiAtMTtcclxufVxyXG5cclxuZnVuY3Rpb24gYWRkQ2xhc3MoZWwsIGNscykge1xyXG4gICAgaWYgKCBoYXNDbGFzcyhlbCwgY2xzKSApIHsgcmV0dXJuOyB9XHJcbiAgICBlbC5jbGFzc05hbWUgKz0gXCIgXCIgKyBjbHM7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHJlbUNsYXNzKGVsLCBjbHMpIHtcclxuICAgIGVsLmNsYXNzTmFtZSA9IGVsLmNsYXNzTmFtZS5yZXBsYWNlKFwiIFwiICsgY2xzLCBcIlwiKTtcclxufVxyXG5cclxuZnVuY3Rpb24gZ2V0UG9pbnRlclBvcyhjLCBlKSB7XHJcbiAgICB2YXIgYmNyID0gYy5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgeDogZS5wYWdlWCAtIGJjci5sZWZ0LFxyXG4gICAgICAgIHk6IGUucGFnZVkgLSBiY3IudG9wXHJcbiAgICB9O1xyXG59XHJcblxyXG5mdW5jdGlvbiBwb2ludEluUmVjdCAocG9pbnQsIHJlY3QpIHtcclxuICAgIHJldHVybiBpblJhbmdlKHBvaW50LngsIHJlY3QueCwgcmVjdC54ICsgcmVjdC53KSAmJiBpblJhbmdlKHBvaW50LnksIHJlY3QueSwgcmVjdC55ICsgcmVjdC5oKTtcclxufVxyXG5cclxuZnVuY3Rpb24gaW5SYW5nZSAodmFsdWUsIG1pbiwgbWF4KSB7XHJcbiAgICByZXR1cm4gdmFsdWUgPj0gTWF0aC5taW4obWluLCBtYXgpICYmIHZhbHVlIDw9IE1hdGgubWF4KG1pbiwgbWF4KTtcclxufVxyXG5cclxuaW5pdCgpOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==